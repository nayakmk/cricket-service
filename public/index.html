<!DOCTYPE html>
<html>
<head>
  <title>Cricket Scoring API</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* Modern App Variables */
    :root {
      --primary-color: #1a73e8;
      --primary-dark: #1557b0;
      --secondary-color: #34a853;
      --accent-color: #ea4335;
      --warning-color: #fbbc04;
      --background-color: #f8f9fa;
      --surface-color: #ffffff;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --border-color: #e8eaed;
      --shadow: 0 1px 3px rgba(60, 64, 67, 0.3);
      --shadow-lg: 0 4px 6px rgba(60, 64, 67, 0.15);
      --border-radius: 8px;
      --border-radius-lg: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.5;
    }

    /* Header Styles */
    .app-header {
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      font-weight: bold;
    }

    .logo-text {
      font-size: 20px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
    }

    /* Navigation */
    .nav-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-links {
      display: flex;
      gap: 8px;
      margin-right: 16px;
    }

    .nav-link {
      padding: 8px 16px;
      border-radius: var(--border-radius);
      text-decoration: none;
      color: var(--text-secondary);
      font-weight: 500;
      transition: var(--transition);
      border: 1px solid transparent;
      white-space: nowrap;
    }

    .nav-link:hover {
      background-color: var(--background-color);
      color: var(--text-primary);
    }

    .nav-link.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* Burger Menu */
    .burger-menu {
      display: none;
      flex-direction: column;
      cursor: pointer;
      padding: 8px;
      border-radius: var(--border-radius);
      transition: var(--transition);
    }

    .burger-menu:hover {
      background-color: var(--background-color);
    }

    .burger-line {
      width: 24px;
      height: 2px;
      background-color: var(--text-primary);
      margin: 3px 0;
      transition: var(--transition);
      transform-origin: center;
    }

    .burger-menu.open .burger-line:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }

    .burger-menu.open .burger-line:nth-child(2) {
      opacity: 0;
    }

    .burger-menu.open .burger-line:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    /* Mobile Navigation Overlay */
    .mobile-nav-overlay {
      position: fixed;
      top: 64px;
      left: 0;
      width: 100%;
      height: calc(100vh - 64px);
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .mobile-nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .mobile-nav {
      position: absolute;
      top: 0;
      left: 0;
      width: 280px;
      height: 100%;
      background: var(--surface-color);
      box-shadow: var(--shadow-lg);
      transform: translateX(-100%);
      transition: var(--transition);
      padding: 20px 0;
    }

    .mobile-nav.open {
      transform: translateX(0);
    }

    .mobile-nav-links {
      display: flex;
      flex-direction: column;
    }

    .mobile-nav-link {
      padding: 16px 24px;
      text-decoration: none;
      color: var(--text-primary);
      font-weight: 500;
      border-bottom: 1px solid var(--border-color);
      transition: var(--transition);
    }

    .mobile-nav-link:hover,
    .mobile-nav-link.active {
      background-color: var(--primary-color);
      color: white;
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
      min-height: calc(100vh - 128px); /* Account for header and footer */
    }

    /* Status Bar */
    .status-bar {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--text-secondary);
    }

    .status-dot.online {
      background-color: var(--secondary-color);
    }

    .status-dot.offline {
      background-color: var(--accent-color);
    }

    /* Status Indicators and Badges */
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
      vertical-align: middle;
    }

    .status-live {
      background-color: var(--secondary-color);
    }

    .status-completed {
      background-color: var(--primary-color);
    }

    .status-scheduled {
      background-color: var(--warning-color);
    }

    .status-upcoming {
      background-color: var(--text-secondary);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-active {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(52, 168, 83, 0.2);
    }

    .status-suspended {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--accent-color);
      border: 1px solid rgba(234, 67, 53, 0.2);
    }

    /* Content Sections */
    .content-section {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .content-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 28px;
      font-weight: 400;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .section-subtitle {
      color: var(--text-secondary);
      margin: 0;
      font-size: 16px;
    }

    /* Cards and Grids */
    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .data-card {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 24px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: 200px;
    }

    .data-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
      border-color: rgba(26, 115, 232, 0.2);
    }

    .data-card h3 {
      margin: 0 0 16px 0;
      color: var(--primary-color);
      font-size: 18px;
      font-weight: 600;
      line-height: 1.3;
    }

    .data-card p {
      margin: 6px 0;
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .data-card p strong {
      color: var(--text-primary);
      font-weight: 500;
    }

    /* API Endpoints */
    .api-section {
      margin-bottom: 32px;
    }

    .api-section h3 {
      color: var(--text-primary);
      margin-bottom: 16px;
      font-size: 20px;
    }

    .api-endpoint {
      background: var(--background-color);
      padding: 12px 16px;
      margin: 8px 0;
      border-left: 4px solid var(--primary-color);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
    }

    /* Footer */
    .app-footer {
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .footer-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-logo {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      font-weight: bold;
    }

    .footer-text {
      color: var(--text-secondary);
      font-size: 14px;
      margin: 0;
    }

    .footer-links {
      display: flex;
      gap: 16px;
    }

    .footer-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: var(--transition);
    }

    .footer-link:hover {
      color: var(--primary-color);
    }

    /* Breadcrumbs */
    .breadcrumbs {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .breadcrumb-item {
      color: var(--text-secondary);
    }

    .breadcrumb-item.active {
      color: var(--text-primary);
      font-weight: 500;
    }

    .breadcrumb-separator {
      color: var(--text-secondary);
      margin: 0 4px;
    }

    /* Back Button */
    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--background-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      text-decoration: none;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 16px;
      transition: var(--transition);
    }

    .back-button:hover {
      background: var(--surface-color);
      box-shadow: var(--shadow);
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      min-height: 40px;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: var(--shadow);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--background-color);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--surface-color);
      box-shadow: var(--shadow);
      border-color: var(--primary-color);
    }

    .btn-success {
      background: var(--secondary-color);
      color: white;
    }

    .btn-success:hover {
      background: #2e7d32;
      box-shadow: var(--shadow);
    }

    .btn-warning {
      background: var(--warning-color);
      color: var(--text-primary);
    }

    .btn-warning:hover {
      background: #f57c00;
      box-shadow: var(--shadow);
    }

    .btn-danger {
      background: var(--accent-color);
      color: white;
    }

    .btn-danger:hover {
      background: #d32f2f;
      box-shadow: var(--shadow);
    }

    /* Card Actions */
    .card-actions {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      flex-shrink: 0;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      min-height: 32px;
    }

    .btn-edit {
      background: var(--warning-color);
      color: var(--text-primary);
      border: 1px solid rgba(251, 188, 4, 0.3);
    }

    .btn-edit:hover {
      background: #f57c00;
      color: white;
      border-color: #f57c00;
    }

    .btn-delete {
      background: var(--accent-color);
      color: white;
      border: 1px solid rgba(234, 67, 53, 0.3);
    }

    .btn-delete:hover {
      background: #d32f2f;
      border-color: #d32f2f;
    }

    /* Forms */
    .form-container {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 32px;
      margin-top: 24px;
      box-shadow: var(--shadow);
      display: none;
    }

    .form-container.active {
      display: block;
    }

    .form-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }

    .form-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .form-subtitle {
      color: var(--text-secondary);
      margin: 0;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 14px;
      background: var(--surface-color);
      transition: var(--transition);
      line-height: 1.4;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 24px;
      border-top: 1px solid var(--border-color);
      margin-top: 24px;
    }

    /* Filter Controls */
    .filter-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--background-color);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
    }

    .filter-controls label {
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
    }

    .filter-controls select {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      background: var(--surface-color);
      font-size: 14px;
      min-width: 120px;
    }

    /* Merge Actions */
    .merge-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding: 16px;
      background: rgba(251, 188, 4, 0.1);
      border: 1px solid rgba(251, 188, 4, 0.2);
      border-radius: var(--border-radius);
    }

    .selection-count {
      margin-left: auto;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Card Checkbox */
    .card-checkbox {
      position: absolute;
      top: 16px;
      right: 16px;
      z-index: 2;
    }

    .card-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        padding: 0 16px;
        height: 56px;
      }

      .logo-text {
        font-size: 18px;
      }

      .nav-links {
        display: none;
      }

      .burger-menu {
        display: flex;
      }

      .main-content {
        padding: 16px;
      }

      .data-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .status-bar {
        flex-direction: column;
        gap: 12px;
        padding: 12px;
      }

      .footer-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }

      .section-title {
        font-size: 24px;
      }

      .api-endpoint {
        font-size: 13px;
        padding: 10px 12px;
      }
    }

    @media (max-width: 480px) {
      .header-content {
        padding: 0 12px;
      }

      .main-content {
        padding: 12px;
      }

      .data-card {
        padding: 16px;
      }

      .status-bar {
        padding: 10px;
      }
    }

    /* Loading and Error States */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
      font-size: 16px;
    }

    .loading::before {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-right: 12px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: linear-gradient(135deg, #fce8e6, #fef7f7);
      border: 1px solid #f28b82;
      border-radius: var(--border-radius);
      padding: 20px;
      color: #c5221f;
      margin: 20px 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .error::before {
      content: '⚠️';
      font-size: 18px;
      margin-right: 8px;
    }

    .success {
      background: linear-gradient(135deg, #e8f5e8, #f1f8f1);
      border: 1px solid #81c784;
      border-radius: var(--border-radius);
      padding: 20px;
      color: #2e7d32;
      margin: 20px 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .success::before {
      content: '✅';
      font-size: 18px;
      margin-right: 8px;
    }

    /* Detail Views - Mobile First */
    .detail-container {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      margin: 16px 0;
      box-shadow: var(--shadow);
      display: none;
      animation: slideIn 0.3s ease-in-out;
      width: 100%;
      box-sizing: border-box;
    }

    /* Tablet and up */
    @media (min-width: 768px) {
      .detail-container {
        padding: 24px;
        margin: 20px 0;
        border-radius: var(--border-radius-lg);
      }
    }

    /* Desktop and up */
    @media (min-width: 1024px) {
      .detail-container {
        padding: 32px;
        margin: 24px 0;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }
    }

    .detail-container.active {
      display: block;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile first - responsive detail header */
    .detail-header {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
      align-items: flex-start;
    }

    /* Tablet and up */
    @media (min-width: 768px) {
      .detail-header {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        margin-bottom: 32px;
        padding-bottom: 20px;
      }
    }

    .detail-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      line-height: 1.3;
      word-break: break-word;
    }

    /* Tablet and up */
    @media (min-width: 768px) {
      .detail-title {
        font-size: 24px;
      }
    }

    .detail-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 8px;
      border-radius: var(--border-radius);
      transition: var(--transition);
      align-self: flex-end;
      margin-top: -8px;
      margin-right: -8px;
    }

    /* Tablet and up */
    @media (min-width: 768px) {
      .detail-close {
        font-size: 24px;
        padding: 4px;
        align-self: center;
        margin-top: 0;
        margin-right: 0;
      }
    }

    .detail-close:hover {
      background: var(--background-color);
      color: var(--text-primary);
    }

    /* Mobile first - detail grid */
    .detail-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 24px;
    }

    /* Small tablets - 2 columns */
    @media (min-width: 640px) {
      .detail-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
    }

    /* Tablets and up - 3 columns */
    @media (min-width: 768px) {
      .detail-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 32px;
      }
    }

    /* Large screens - 4 columns */
    @media (min-width: 1024px) {
      .detail-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .detail-item {
      background: var(--background-color);
      padding: 12px 16px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-item {
        padding: 16px 20px;
      }
    }

    .detail-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow);
    }

    .detail-item strong {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      opacity: 0.8;
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-item strong {
        font-size: 11px;
      }
    }

    .detail-item span,
    .detail-item div:not(:first-child) {
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      line-height: 1.4;
      word-break: break-word;
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-item span,
      .detail-item div:not(:first-child) {
        font-size: 15px;
      }
    }

    /* Tables - Mobile First */
    .table-container,
    .matches-table-container {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      margin: 20px 0;
      width: 100%;
      box-sizing: border-box;
    }

    /* Mobile - horizontal scroll for tables */
    @media (max-width: 767px) {
      .table-container,
      .matches-table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin: 16px -16px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }
    }

    table,
    .data-table,
    .innings-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      line-height: 1.4;
    }

    /* Mobile table adjustments */
    @media (max-width: 767px) {
      table,
      .data-table,
      .innings-table {
        min-width: 600px; /* Ensure minimum width for scrolling */
        font-size: 12px;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      table,
      .data-table,
      .innings-table {
        font-size: 14px;
      }
    }

    th, td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      font-size: inherit;
      line-height: 1.4;
    }

    /* Mobile table cell padding */
    @media (max-width: 767px) {
      th, td {
        padding: 6px 8px;
        white-space: nowrap;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      th, td {
        padding: 12px 16px;
      }
    }

    th {
      background: linear-gradient(135deg, var(--background-color), var(--surface-color));
      font-weight: 600;
      color: var(--text-primary);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: sticky;
      top: 0;
      z-index: 1;
      border-bottom: 2px solid var(--primary-color);
    }

    /* Mobile table headers */
    @media (max-width: 767px) {
      th {
        font-size: 10px;
        padding: 8px 6px;
        position: relative; /* Remove sticky on mobile for better scrolling */
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      th {
        font-size: 12px;
      }
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background-color: rgba(26, 115, 232, 0.04);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    /* Cricket-specific table styling */
    .innings-table {
      margin-bottom: 24px;
    }

    .innings-table th {
      background: linear-gradient(135deg, var(--secondary-color), #2e7d32);
      color: white;
      border-bottom-color: #2e7d32;
    }

    .innings-table th:first-child {
      border-top-left-radius: var(--border-radius);
    }

    .innings-table th:last-child {
      border-top-right-radius: var(--border-radius);
    }

    /* Data table for match performance */
    .data-table {
      border-collapse: separate;
      border-spacing: 0;
    }

    .data-table th {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      border-bottom-color: var(--primary-dark);
    }

    /* Cricket-specific styling */
    .inning-details {
      background: var(--background-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      margin: 20px 0;
    }

    /* Mobile adjustments for innings */
    @media (max-width: 767px) {
      .inning-details {
        padding: 12px;
        margin: 16px -16px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .inning-details {
        padding: 20px;
      }
    }

    .inning-details h5 {
      color: var(--secondary-color);
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 16px 0;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--secondary-color);
    }

    /* Mobile innings headings */
    @media (max-width: 767px) {
      .inning-details h5 {
        font-size: 14px;
        margin-bottom: 12px;
      }
    }

    .inning-details h6 {
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      margin: 20px 0 12px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Mobile sub-headings */
    @media (max-width: 767px) {
      .inning-details h6 {
        font-size: 13px;
        margin: 16px 0 8px 0;
      }
    }

    /* Cricket stat highlights */
    .stat-highlight {
      background: linear-gradient(135deg, var(--secondary-color), #2e7d32);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 600;
      font-size: 12px;
    }

    /* Mobile stat highlights */
    @media (max-width: 767px) {
      .stat-highlight {
        font-size: 11px;
        padding: 1px 4px;
      }
    }

    /* Performance indicators */
    .performance-good {
      color: var(--secondary-color);
      font-weight: 600;
    }

    .performance-average {
      color: var(--warning-color);
      font-weight: 500;
    }

    .performance-poor {
      color: var(--accent-color);
      font-weight: 500;
    }

    /* Detail section headings */
    .detail-container h3 {
      color: var(--primary-color);
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 24px 0;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--primary-color);
    }

    /* Mobile detail headings */
    @media (max-width: 767px) {
      .detail-container h3 {
        font-size: 18px;
        margin-bottom: 20px;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-container h3 {
        font-size: 22px;
      }
    }

    .detail-container h4 {
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
      margin: 32px 0 20px 0;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color);
      background: linear-gradient(135deg, var(--background-color), var(--surface-color));
      padding-left: 16px;
      margin-left: -16px;
      margin-right: -16px;
      padding-right: 16px;
    }

    /* Mobile h4 headings */
    @media (max-width: 767px) {
      .detail-container h4 {
        font-size: 15px;
        margin: 24px -16px 16px -16px;
        padding: 12px 16px;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-container h4 {
        font-size: 18px;
        margin: 40px 0 24px 0;
        padding-left: 20px;
        margin-left: -20px;
        margin-right: -20px;
        padding-right: 20px;
      }
    }

    /* Detail actions - mobile first */
    .detail-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border-color);
    }

    /* Mobile detail actions */
    @media (max-width: 767px) {
      .detail-actions {
        flex-direction: column;
        gap: 8px;
        margin-top: 24px;
        padding-top: 20px;
      }

      .detail-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
      .detail-actions {
        justify-content: flex-end;
        gap: 16px;
      }
    }

    /* Enhanced mobile touch targets */
    @media (max-width: 767px) {
      .btn {
        min-height: 44px; /* iOS touch target minimum */
        padding: 12px 16px;
        font-size: 16px; /* Prevent zoom on iOS */
      }

      .detail-close {
        min-width: 44px;
        min-height: 44px;
      }
    }

    /* Cricket score display */
    .score-display {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 18px;
      font-weight: 600;
      color: var(--secondary-color);
      background: rgba(52, 168, 83, 0.1);
      padding: 8px 12px;
      border-radius: var(--border-radius);
      display: inline-block;
      margin: 4px 0;
    }

    /* Mobile score display */
    @media (max-width: 767px) {
      .score-display {
        font-size: 16px;
        padding: 6px 10px;
      }
    }

    /* Status badges in details */
    .status-live,
    .status-completed,
    .status-scheduled {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-live {
      background: rgba(52, 168, 83, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(52, 168, 83, 0.2);
    }

    .status-completed {
      background: rgba(26, 115, 232, 0.1);
      color: var(--primary-color);
      border: 1px solid rgba(26, 115, 232, 0.2);
    }

    .status-scheduled {
      background: rgba(251, 188, 4, 0.1);
      color: #f57c00;
      border: 1px solid rgba(251, 188, 4, 0.2);
    }

    /* Mobile status badges */
    @media (max-width: 767px) {
      .status-live,
      .status-completed,
      .status-scheduled {
        font-size: 11px;
        padding: 4px 8px;
      }
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--surface-color);
      border-radius: var(--border-radius-lg);
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      transform: scale(0.9);
      transition: var(--transition);
    }

    .modal.active .modal-content {
      transform: scale(1);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      color: var(--text-primary);
      font-size: 20px;
    }

    .modal-close {
      font-size: 24px;
      cursor: pointer;
      color: var(--text-secondary);
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
    }
  </style>
</head>
<body>
  <!-- App Header -->
  <header class="app-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">🏏</div>
        <div>
          <h1 class="logo-text">CricketScores</h1>
          <p class="subtitle">API Explorer</p>
        </div>
      </div>

      <nav class="nav-container">
        <div class="nav-links">
          <a href="#" class="nav-link active" onclick="showSection('overview')">Overview</a>
          <a href="#" class="nav-link" onclick="showSection('matches')">Matches</a>
          <a href="#" class="nav-link" onclick="showSection('teams')">Teams</a>
          <a href="#" class="nav-link" onclick="showSection('players')">Players</a>
          <a href="#" class="nav-link" onclick="showSection('lineups')">Lineups</a>
        </div>

        <div class="burger-menu" onclick="toggleMobileMenu()">
          <div class="burger-line"></div>
          <div class="burger-line"></div>
          <div class="burger-line"></div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Mobile Navigation Overlay -->
  <div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="toggleMobileMenu()">
    <nav class="mobile-nav" id="mobileNav">
      <div class="mobile-nav-links">
        <a href="#" class="mobile-nav-link active" onclick="showSection('overview')">Overview</a>
        <a href="#" class="mobile-nav-link" onclick="showSection('matches')">Matches</a>
        <a href="#" class="mobile-nav-link" onclick="showSection('teams')">Teams</a>
        <a href="#" class="mobile-nav-link" onclick="showSection('players')">Players</a>
        <a href="#" class="mobile-nav-link" onclick="showSection('lineups')">Lineups</a>
      </div>
    </nav>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item">
        <div class="status-dot" id="apiStatusDot"></div>
        <span><strong>API:</strong> <span id="api-status">Checking...</span></span>
      </div>
      <div class="status-item">
        <div class="status-dot" id="dbStatusDot"></div>
        <span><strong>Database:</strong> <span id="db-status">Checking...</span></span>
      </div>
    </div>

    <!-- Overview Section -->
    <section id="overview" class="content-section active">
      <div class="section-header">
        <h2 class="section-title">API Overview</h2>
        <p class="section-subtitle">Explore cricket data through our comprehensive API</p>
      </div>

      <div class="api-section">
        <h3>🏏 Matches</h3>
        <div class="api-endpoint">GET /api/matches - Get all matches</div>
        <div class="api-endpoint">GET /api/matches/{id} - Get specific match details</div>
      </div>

      <div class="api-section">
        <h3>👥 Teams</h3>
        <div class="api-endpoint">GET /api/teams - Get all teams</div>
        <div class="api-endpoint">GET /api/teams/{id} - Get specific team information</div>
      </div>

      <div class="api-section">
        <h3>🏃 Players</h3>
        <div class="api-endpoint">GET /api/players - Get all players</div>
        <div class="api-endpoint">GET /api/players/{id} - Get detailed player statistics</div>
        <div class="api-endpoint">POST /api/players/merge - Merge duplicate players</div>
      </div>

      <div class="api-section">
        <h3>📋 Team Lineups</h3>
        <div class="api-endpoint">GET /api/teamLineups - Get all team lineups</div>
        <div class="api-endpoint">GET /api/teamLineups/{id} - Get specific lineup details</div>
      </div>

      <div class="api-section">
        <h3>🎯 Live Scoring</h3>
        <div class="api-endpoint">POST /api/scoring/start-inning - Start a new inning</div>
        <div class="api-endpoint">POST /api/scoring/record-ball - Record ball-by-ball data</div>
      </div>
    </section>

    <div id="matches" class="content-section">
      <h2>Matches</h2>
      <div class="form-actions">
        <button class="btn" onclick="loadMatches()">Load All Matches</button>
        <button class="btn btn-secondary" onclick="showCreateMatchForm()">Create New Match</button>
      </div>
      <div id="matches-content"></div>
      <div id="match-detail" class="detail-view" style="display: none;"></div>
      <div id="matches-form" class="form-container">
        <h3 id="matches-form-title">Create New Match & Start Scoring</h3>
        <form id="matches-form-element">
          <div class="form-row">
            <div class="form-group">
              <label for="matchType">Match Type:</label>
              <select id="matchType" required>
                <option value="T20">T20</option>
                <option value="ODI">ODI</option>
                <option value="Test">Test</option>
              </select>
            </div>
            <div class="form-group">
              <label for="venue">Venue:</label>
              <input type="text" id="venue" required>
            </div>
          </div>
          <div class="form-group">
            <label for="scheduledDate">Scheduled Date:</label>
            <input type="datetime-local" id="scheduledDate" required>
          </div>

          <div class="team-selection-section">
            <h4>Select Teams & Players</h4>
            <div class="team-selection-grid">
              <div class="team-panel">
                <h5>Team 1</h5>
                <div class="form-group">
                  <label for="team1Id">Select Team:</label>
                  <select id="team1Id" required onchange="onTeamChange('team1')">
                    <option value="">Choose a team...</option>
                  </select>
                  <button type="button" class="btn btn-small" onclick="loadTeamPlayers('team1')" id="loadTeam1Btn" disabled>Load Players</button>
                </div>
                <div id="team1-players" class="player-selection-list">
                  <p>Select team and click "Load Players"</p>
                </div>
              </div>

              <div class="team-panel">
                <h5>Team 2</h5>
                <div class="form-group">
                  <label for="team2Id">Select Team:</label>
                  <select id="team2Id" required onchange="onTeamChange('team2')">
                    <option value="">Choose a team...</option>
                  </select>
                  <button type="button" class="btn btn-small" onclick="loadTeamPlayers('team2')" id="loadTeam2Btn" disabled>Load Players</button>
                </div>
                <div id="team2-players" class="player-selection-list">
                  <p>Select team and click "Load Players"</p>
                </div>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn">Create Match & Start Scoring</button>
            <button type="button" class="btn btn-secondary" onclick="hideCreateForm('matches')">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="teams" class="content-section">
      <h2>Teams</h2>
      <div class="form-actions">
        <button class="btn" onclick="loadTeams()">Load All Teams</button>
        <button class="btn btn-secondary" onclick="showCreateForm('teams')">Create New Team</button>
      </div>
      <div id="teams-content"></div>
      <div id="team-detail" class="detail-view" style="display: none;"></div>
      <div id="teams-form" class="form-container">
        <h3 id="teams-form-title">Create New Team</h3>
        <form id="teams-form-element">
          <div class="form-group">
            <label for="teamName">Team Name:</label>
            <input type="text" id="teamName" required>
          </div>
          <div class="form-group">
            <label for="shortName">Short Name:</label>
            <input type="text" id="shortName" required>
          </div>
          <div class="form-group">
            <label for="captainId">Captain ID (optional):</label>
            <input type="text" id="captainId" placeholder="Enter formatted player ID">
          </div>
          <div class="form-group">
            <label for="homeGround">Home Ground:</label>
            <input type="text" id="homeGround">
          </div>
          <div class="form-group">
            <label for="foundedYear">Founded Year:</label>
            <input type="number" id="foundedYear" min="1800" max="2030">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn">Save Team</button>
            <button type="button" class="btn btn-secondary" onclick="hideCreateForm('teams')">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="players" class="content-section">
      <h2>Players</h2>
      <div class="form-actions">
        <button class="btn" onclick="loadPlayers()">Load All Players</button>
        <button class="btn btn-secondary" onclick="showCreateForm('players')">Create New Player</button>
        <button class="btn btn-success" onclick="recalculatePlayerStats()">Recalculate Statistics</button>
      </div>
      <div id="players-content"></div>
      <div id="player-detail" class="detail-view" style="display: none;"></div>
      <div id="players-form" class="form-container">
        <h3 id="players-form-title">Create New Player</h3>
        <form id="players-form-element">
          <div class="form-group">
            <label for="playerName">Player Name:</label>
            <input type="text" id="playerName" required>
          </div>
          <div class="form-group">
            <label for="role">Role:</label>
            <select id="role" required>
              <option value="Batsman">Batsman</option>
              <option value="Bowler">Bowler</option>
              <option value="All-rounder">All-rounder</option>
              <option value="Wicket-keeper">Wicket-keeper</option>
            </select>
          </div>
          <div class="form-group">
            <label for="battingStyle">Batting Style:</label>
            <select id="battingStyle">
              <option value="">Select...</option>
              <option value="Right-handed">Right-handed</option>
              <option value="Left-handed">Left-handed</option>
            </select>
          </div>
          <div class="form-group">
            <label for="bowlingStyle">Bowling Style:</label>
            <input type="text" id="bowlingStyle" placeholder="e.g., Right-arm fast, Left-arm spin">
          </div>
          <div class="form-group">
            <label for="teamId">Team ID (optional):</label>
            <input type="text" id="teamId" placeholder="Enter formatted team ID">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn">Save Player</button>
            <button type="button" class="btn btn-secondary" onclick="hideCreateForm('players')">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="lineups" class="content-section">
      <h2>Team Lineups</h2>
      <div class="form-actions">
        <button class="btn" onclick="loadLineups()">Load All Lineups</button>
        <button class="btn btn-secondary" onclick="showCreateForm('lineups')">Create New Lineup</button>
      </div>
      <div id="lineups-content"></div>
      <div id="lineup-detail" class="detail-view" style="display: none;"></div>
      <div id="lineups-form" class="form-container">
        <h3 id="lineups-form-title">Create New Team Lineup</h3>
        <form id="lineups-form-element">
          <div class="form-group">
            <label for="lineupTeamId">Team ID:</label>
            <input type="text" id="lineupTeamId" placeholder="Enter formatted team ID" required>
          </div>
          <div class="form-group">
            <label for="captain">Captain ID:</label>
            <input type="text" id="captain" placeholder="Enter formatted player ID" required>
          </div>
          <div class="form-group">
            <label for="wicketKeeper">Wicket Keeper ID:</label>
            <input type="text" id="wicketKeeper" placeholder="Enter formatted player ID" required>
          </div>
          <div class="form-group">
            <label for="players">Player IDs (comma-separated):</label>
            <textarea id="players" placeholder="Enter formatted player IDs separated by commas" required></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn">Save Lineup</button>
            <button type="button" class="btn btn-secondary" onclick="hideCreateForm('lineups')">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    let currentData = {};
    let editingId = null;
    let selectedPlayers = [];

    // Merge functionality
    function togglePlayerSelection(playerId) {
      console.log('togglePlayerSelection called with:', playerId);
      const checkbox = document.getElementById(`player-${playerId}`);
      console.log('Checkbox found:', checkbox);
      if (checkbox.checked) {
        if (!selectedPlayers.includes(playerId)) {
          selectedPlayers.push(playerId);
        }
      } else {
        selectedPlayers = selectedPlayers.filter(id => id !== playerId);
      }
      console.log('Selected players now:', selectedPlayers);
      updateMergeUI();
    }

    function clearSelection() {
      selectedPlayers.forEach(playerId => {
        const checkbox = document.getElementById(`player-${playerId}`);
        if (checkbox) checkbox.checked = false;
      });
      selectedPlayers = [];
      updateMergeUI();
    }

    function updateMergeUI() {
      console.log('updateMergeUI called, selectedPlayers:', selectedPlayers);
      const mergeActions = document.getElementById('merge-actions');
      const selectionCount = document.getElementById('selection-count');

      console.log('mergeActions element:', mergeActions);
      if (mergeActions) {
        if (selectedPlayers.length > 0) {
          mergeActions.style.display = 'block';
          if (selectionCount) {
            selectionCount.textContent = `${selectedPlayers.length} player${selectedPlayers.length > 1 ? 's' : ''} selected`;
          }
          console.log('Showing merge actions');
        } else {
          mergeActions.style.display = 'none';
          console.log('Hiding merge actions');
        }
      }
    }

    function filterPlayersByStatus() {
      const filterValue = document.getElementById('player-status-filter').value;
      const playerCards = document.querySelectorAll('.data-card');
      
      playerCards.forEach(card => {
        const isActive = card.classList.contains('status-active');
        const isSuspended = card.classList.contains('status-suspended');
        
        switch(filterValue) {
          case 'active':
            card.style.display = isActive ? 'block' : 'none';
            break;
          case 'suspended':
            card.style.display = isSuspended ? 'block' : 'none';
            break;
          default: // 'all'
            card.style.display = 'block';
            break;
        }
      });
      
      // Update the count display
      const visibleCards = Array.from(playerCards).filter(card => card.style.display !== 'none');
      const countText = document.querySelector('#players-content p');
      if (countText) {
        const totalText = countText.textContent.replace(/\d+/, visibleCards.length);
        countText.textContent = totalText;
      }
    }

    function showMergeModal() {
      console.log('showMergeModal called, selectedPlayers:', selectedPlayers);
      if (selectedPlayers.length < 2) {
        alert('Please select at least 2 players to merge.');
        return;
      }

      console.log('Creating merge modal...');
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>Merge Players</h3>
            <span class="modal-close" onclick="this.closest('.modal').remove()">&times;</span>
          </div>
          <div class="modal-body">
            <p>Select which player profile should be the final merged profile:</p>
            <div class="merge-preview">
              <div class="primary-player-selection">
                ${selectedPlayers.map((playerId, index) => {
                  const player = getPlayerById(playerId);
                  return `
                    <div class="player-option">
                      <label class="player-radio-label">
                        <input type="radio" name="primaryPlayer" value="${playerId}" ${index === 0 ? 'checked' : ''}>
                        <div class="player-info">
                          <strong>${player.name}</strong>
                          <div class="player-stats">
                            ${player.matchesPlayed || 0} matches • ${player.totalRuns || 0} runs • ${player.totalWickets || 0} wickets
                          </div>
                        </div>
                      </label>
                    </div>
                  `;
                }).join('')}
              </div>
              <div class="merge-info">
                <h4>What happens during merge:</h4>
                <ul>
                  <li>✅ Player statistics will be combined</li>
                  <li>✅ All match references will be updated</li>
                  <li>✅ Team lineups will be updated</li>
                  <li>✅ Duplicate players will be deactivated</li>
                </ul>
              </div>
              <p class="warning"><strong>This action cannot be undone!</strong></p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
            <button class="btn btn-danger" onclick="performMerge()">Merge Players</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      console.log('Modal added to body');
    }

    function getPlayerById(playerId) {
      return currentData.players.find(p => p.id === playerId);
    }

    async function performMerge() {
      if (selectedPlayers.length < 2) return;

      // Get the selected primary player from radio buttons
      const primaryPlayerRadio = document.querySelector('input[name="primaryPlayer"]:checked');
      if (!primaryPlayerRadio) {
        alert('Please select a primary player.');
        return;
      }

      const primaryPlayerId = primaryPlayerRadio.value;
      const playersToMerge = selectedPlayers.filter(id => id !== primaryPlayerId);

      try {
        const result = await apiCall('/api/players/merge', 'POST', {
          primaryPlayerId,
          playersToMerge
        });

        document.querySelector('.modal').remove();
        showSuccess('players-content', `Players merged successfully! ${result.stats.playersDeactivated} players deactivated, ${result.stats.teamLineupsUpdated} team lineups updated, ${result.stats.matchesUpdated} matches updated.`);
        clearSelection();
        loadPlayers();
      } catch (error) {
        showError('players-content', error);
      }
    }

    // Form management functions
    function showCreateForm(section) {
      hideAllForms();
      const form = document.getElementById(`${section}-form`);
      const content = document.getElementById(`${section}-content`);
      const formTitle = document.getElementById(`${section}-form-title`);

      if (form) form.classList.add('active');
      if (content) content.style.display = 'none';
      if (formTitle) formTitle.textContent = 'Create New ' + section.charAt(0).toUpperCase() + section.slice(1).slice(0, -1);
      editingId = null;
      clearForm(section);

      // Reset form state for lineups
      if (section === 'lineups') {
        const form = document.getElementById('lineups-form-element');
        form.removeAttribute('data-mode');
        form.removeAttribute('data-lineup-id');
        document.getElementById('lineups-form-title').textContent = 'Create New Team Lineup';
      }
    }

    function hideCreateForm(section) {
      const form = document.getElementById(`${section}-form`);
      const content = document.getElementById(`${section}-content`);
      if (form) {
        form.classList.remove('active');
        form.style.display = 'none'; // Clear any inline styles
      }
      if (content) {
        content.style.display = 'block';
      }
      editingId = null;
    }

    function hideAllForms() {
      document.querySelectorAll('.form-container').forEach(form => {
        form.classList.remove('active');
      });
    }

    function clearForm(section) {
      const form = document.getElementById(`${section}-form-element`);
      form.reset();
    }

    // CRUD API functions
    async function apiCall(endpoint, method = 'GET', data = null) {
      const config = {
        method: method,
        headers: {
          'Content-Type': 'application/json',
        },
      };

      if (data && method !== 'GET') {
        config.body = JSON.stringify(data);
      }

      try {
        const response = await fetch(endpoint, config);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return await response.json();
      } catch (error) {
        console.error('API Call Failed:', error);
        throw error;
      }
    }
    window.onload = function() {
      checkApiStatus();
    };

    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      event.target.classList.add('active');
    }

    async function checkApiStatus() {
      try {
        const response = await fetch('/api/matches');
        if (response.ok) {
          document.getElementById('api-status').innerHTML = '✅ API Server Running';
          document.getElementById('db-status').innerHTML = '✅ Firestore Connected';
        } else {
          throw new Error('API not responding');
        }
      } catch (error) {
        document.getElementById('api-status').innerHTML = '❌ API Server Error';
        document.getElementById('db-status').innerHTML = '❌ Database Connection Failed';
        console.error('API Status Check Failed:', error);
      }
    }

    function showLoading(elementId) {
      document.getElementById(elementId).innerHTML = '<div class="loading">Loading...</div>';
    }

    function showError(elementId, error) {
      document.getElementById(elementId).innerHTML = `<div class="error">Error: ${error.message}</div>`;
    }

    // Utility functions
    function showSuccess(elementId, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `<div class="success">${message}</div>`;
      } else {
        // Fallback to global success message if element not found
        const successDiv = document.createElement('div');
        successDiv.className = 'success';
        successDiv.textContent = message;
        document.querySelector('.container').insertBefore(successDiv, document.querySelector('.nav-tabs'));

        setTimeout(() => {
          successDiv.remove();
        }, 3000);
      }
    }

    // CRUD Operations

    // Teams CRUD
    async function createTeam(teamData) {
      return await apiCall('/api/teams', 'POST', teamData);
    }

    async function updateTeam(teamId, teamData) {
      return await apiCall(`/api/teams/${teamId}`, 'PUT', teamData);
    }

    async function deleteTeam(teamId) {
      return await apiCall(`/api/teams/${teamId}`, 'DELETE');
    }

    // Form handlers
    document.getElementById('teams-form-element').addEventListener('submit', async function(e) {
      e.preventDefault();

      const teamData = {
        name: document.getElementById('teamName').value,
        shortName: document.getElementById('shortName').value,
        captainId: document.getElementById('captainId').value || null,
        homeGround: document.getElementById('homeGround').value || null,
        foundedYear: document.getElementById('foundedYear').value ? parseInt(document.getElementById('foundedYear').value) : null
      };

      try {
        if (editingId) {
          // Update existing team
          await apiCall(`/api/teams/${editingId}`, 'PUT', teamData);
          showSuccess('teams-content', 'Team updated successfully!');
        } else {
          // Create new team
          await apiCall('/api/teams', 'POST', teamData);
          showSuccess('teams-content', 'Team created successfully!');
        }
        hideCreateForm('teams');
        loadTeams(); // Refresh the list
      } catch (error) {
        showError('teams-content', error);
      }
    });

    // Edit/Delete handlers
    function editTeam(teamId, event) {
      event.stopPropagation();
      const team = currentData.teams.find(t => t.id === teamId);
      if (!team) return;

      editingId = teamId;
      showCreateForm('teams');
      document.getElementById('teams-form-title').textContent = 'Edit Team';

      // Populate form
      document.getElementById('teamName').value = team.name || '';
      document.getElementById('shortName').value = team.shortName || '';
      document.getElementById('captainId').value = team.captainId || '';
      document.getElementById('homeGround').value = team.homeGround || '';
      document.getElementById('foundedYear').value = team.foundedYear || '';
    }

    async function deleteTeam(teamId, event) {
      event.stopPropagation();

      if (!confirm('Are you sure you want to delete this team? This action cannot be undone.')) {
        return;
      }

      try {
        await apiCall(`/api/teams/${teamId}`, 'DELETE');
        showSuccess('teams-content', 'Team deleted successfully!');
        loadTeams(); // Refresh the list
      } catch (error) {
        showError('teams-content', error);
      }
    }

    // Form handlers for APIs that don't support operations yet
    document.getElementById('matches-form-element').addEventListener('submit', async function(e) {
      e.preventDefault();

      const team1Id = document.getElementById('team1Id').value.trim();
      const team2Id = document.getElementById('team2Id').value.trim();

      if (!team1Id || !team2Id) {
        showError('matches-content', new Error('Please select both teams'));
        return;
      }

      if (team1Id === team2Id) {
        showError('matches-content', new Error('Please select different teams'));
        return;
      }

      const matchData = {
        title: document.getElementById('matchType').value,
        venue: document.getElementById('venue').value.trim(),
        scheduledDate: document.getElementById('scheduledDate').value,
        team1Id: team1Id,
        team2Id: team2Id
      };

      // Get selected players for each team
      const team1Players = getSelectedPlayers('team1');
      const team2Players = getSelectedPlayers('team2');

      if (team1Players.length === 0 || team2Players.length === 0) {
        showError('matches-content', new Error('Please select players for both teams'));
        return;
      }

      try {
        // Create the match
        const result = await apiCall('/api/matches', 'POST', matchData);
        const matchId = result.data.id;

        showSuccess('matches-content', `Match created successfully! Starting scoring interface...`);

        // Start the scoring interface
        setTimeout(() => {
          startMatchScoring(matchId, matchData, team1Players, team2Players);
        }, 1500);

      } catch (error) {
        console.error('Match creation failed:', error);
        showError('matches-content', error);
      }
    });

    // Function to populate team dropdowns
    async function populateTeamDropdowns() {
      try {
        // Load teams if not already loaded
        if (!currentData.teams || currentData.teams.length === 0) {
          const data = await apiCall('/api/teams');
          currentData.teams = data.data;
        }

        const teams = currentData.teams;
        const team1Select = document.getElementById('team1Id');
        const team2Select = document.getElementById('team2Id');

        // Clear existing options except the first one
        team1Select.innerHTML = '<option value="">Choose a team...</option>';
        team2Select.innerHTML = '<option value="">Choose a team...</option>';

        // Add teams to both dropdowns
        teams.forEach(team => {
          const option1 = document.createElement('option');
          option1.value = team.id;
          option1.textContent = `${team.name} (${team.displayId || team.id})`;
          team1Select.appendChild(option1);

          const option2 = document.createElement('option');
          option2.value = team.id;
          option2.textContent = `${team.name} (${team.displayId || team.id})`;
          team2Select.appendChild(option2);
        });
      } catch (error) {
        console.error('Failed to load teams for dropdowns:', error);
      }
    }

    // Function to handle team selection changes
    function onTeamChange(teamPrefix) {
      const select = document.getElementById(`${teamPrefix}Id`);
      const loadBtn = document.getElementById(`load${teamPrefix.charAt(0).toUpperCase() + teamPrefix.slice(1)}Btn`);
      const selectedValue = select.value;

      // Enable/disable load players button
      loadBtn.disabled = !selectedValue;

      // Clear player selection if team changed
      const playersDiv = document.getElementById(`${teamPrefix}-players`);
      if (!selectedValue) {
        playersDiv.innerHTML = '<p>Select team and click "Load Players"</p>';
      }
    }

    // Function to show the match creation form with populated dropdowns
    function showCreateMatchForm() {
      showCreateForm('matches');
      populateTeamDropdowns();
    }

    document.getElementById('players-form-element').addEventListener('submit', async function(e) {
      e.preventDefault();

      const formData = {
        name: document.getElementById('playerName').value.trim(),
        role: document.getElementById('role').value,
        battingStyle: document.getElementById('battingStyle').value || null,
        bowlingStyle: document.getElementById('bowlingStyle').value.trim() || null,
        teamId: document.getElementById('teamId').value.trim() || null
      };

      const mode = this.getAttribute('data-mode') || 'create';
      const playerId = this.getAttribute('data-player-id');

      try {
        let result;
        if (mode === 'edit' && playerId) {
          // Update existing player
          result = await apiCall(`/api/players/${playerId}`, 'PUT', formData);
          showSuccess('players-content', `Player "${formData.name}" updated successfully!`);
        } else {
          // Create new player
          result = await apiCall('/api/players', 'POST', formData);
          showSuccess('players-content', `Player "${formData.name}" created successfully!`);
        }

        // Reset form and hide it
        this.reset();
        this.removeAttribute('data-mode');
        this.removeAttribute('data-player-id');
        document.getElementById('players-form-title').textContent = 'Create New Player';
        hideCreateForm('players');

        // Reload players list
        await loadPlayers();

      } catch (error) {
        showError('players-content', error);
      }
    });

    document.getElementById('lineups-form-element').addEventListener('submit', async function(e) {
      e.preventDefault();

      const playerIds = document.getElementById('players').value
        .split(',')
        .map(id => id.trim())
        .filter(id => id.length > 0);

      const lineupData = {
        teamId: document.getElementById('lineupTeamId').value.trim(),
        teamName: '', // Will be resolved by API
        captainId: document.getElementById('captain').value.trim(),
        wicketKeeperId: document.getElementById('wicketKeeper').value.trim(),
        playerIds: playerIds,
        playingXI: playerIds.slice(0, 11) // First 11 players as playing XI
      };

      const mode = this.getAttribute('data-mode') || 'create';
      const lineupId = this.getAttribute('data-lineup-id');

      try {
        let result;
        if (mode === 'edit' && lineupId) {
          // Update existing lineup
          result = await apiCall(`/api/teamLineups/${lineupId}`, 'PUT', lineupData);
          showSuccess('lineups-content', 'Team lineup updated successfully!');
        } else {
          // Create new lineup
          result = await apiCall('/api/teamLineups', 'POST', lineupData);
          showSuccess('lineups-content', 'Team lineup created successfully!');
        }

        // Reset form and hide it
        this.reset();
        this.removeAttribute('data-mode');
        this.removeAttribute('data-lineup-id');
        document.getElementById('lineups-form-title').textContent = 'Create New Team Lineup';
        hideCreateForm('lineups');

        // Reload lineups list
        await loadLineups();

      } catch (error) {
        showError('lineups-content', error);
      }
    });

    async function editMatch(matchId, event) {
      event.stopPropagation();

      try {
        // Get match details
        const matchResponse = await apiCall(`/api/matches/${matchId}`);
        const match = matchResponse.data;

        if (match.status === 'scheduled') {
          // Show edit form for scheduled matches
          showEditMatchForm(match);
        } else if (match.status === 'live' || match.status === 'completed') {
          // For live/completed matches, show scoring view
          showMatchScoringView(match);
        } else {
          // For other statuses, allow editing
          showEditMatchForm(match);
        }
      } catch (error) {
        console.error('Error loading match for editing:', error);
        showError('matches-content', error);
      }
    }

    function showEditMatchForm(match) {
      const formHtml = `
        <div class="form-container">
          <h3>Edit Match</h3>
          <form id="editMatchForm">
            <div class="form-group">
              <label for="editMatchType">Match Type:</label>
              <input type="text" id="editMatchType" value="${match.title || ''}" required>
            </div>

            <div class="form-group">
              <label for="editVenue">Venue:</label>
              <input type="text" id="editVenue" value="${match.venue || ''}" required>
            </div>

            <div class="form-group">
              <label for="editScheduledDate">Scheduled Date:</label>
              <input type="datetime-local" id="editScheduledDate" value="${match.scheduledDate ? new Date(match.scheduledDate).toISOString().slice(0, 16) : ''}" required>
            </div>

            <div class="form-group">
              <label for="editStatus">Status:</label>
              <select id="editStatus">
                <option value="scheduled" ${match.status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                <option value="live" ${match.status === 'live' ? 'selected' : ''}>Live</option>
                <option value="completed" ${match.status === 'completed' ? 'selected' : ''}>Completed</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="button" class="btn" onclick="updateMatch('${match.id}')">Update Match</button>
              <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
              ${match.status === 'scheduled' ? `<button type="button" class="btn btn-primary" onclick="startScoringFromEdit('${match.id}')">Start Scoring</button>` : ''}
            </div>
          </form>
        </div>
      `;

      document.getElementById('matches-content').innerHTML = formHtml;
    }

    async function updateMatch(matchId) {
      const matchData = {
        title: document.getElementById('editMatchType').value,
        venue: document.getElementById('editVenue').value,
        scheduledDate: document.getElementById('editScheduledDate').value,
        status: document.getElementById('editStatus').value
      };

      try {
        await apiCall(`/api/matches/${matchId}`, 'PUT', matchData);
        showSuccess('matches-content', 'Match updated successfully!');
        setTimeout(() => loadMatches(), 1500);
      } catch (error) {
        showError('matches-content', error);
      }
    }

    function startScoringFromEdit(matchId) {
      // Get the match data and start scoring
      apiCall(`/api/matches/${matchId}`)
        .then(response => {
          const match = response.data;
          // Load teams and players data
          return Promise.all([
            apiCall('/api/teams'),
            apiCall('/api/players'),
            Promise.resolve(match)
          ]);
        })
        .then(([teamsResponse, playersResponse, match]) => {
          currentData.teams = teamsResponse.data;
          currentData.players = playersResponse.data;

          // Get team players (this is a simplified approach - in reality you'd need team lineups)
          const team1Players = getPlayersForTeam(match.teams?.team1?.id || match.team1Id);
          const team2Players = getPlayersForTeam(match.teams?.team2?.id || match.team2Id);

          startMatchScoring(match.id, match, team1Players, team2Players);
        })
        .catch(error => {
          console.error('Error starting scoring from edit:', error);
          showError('matches-content', error);
        });
    }

    function getPlayersForTeam(teamId) {
      // This is a simplified function - in a real app you'd get team lineups
      // For now, return some default players
      return currentData.players ? currentData.players.slice(0, 11).map(p => p.id) : [];
    }

    function showMatchScoringView(match) {
      // For live/completed matches, show the scoring interface
      if (match.status === 'live' || match.status === 'completed') {
        // Load teams and players data first
        Promise.all([
          apiCall('/api/teams'),
          apiCall('/api/players')
        ])
        .then(([teamsResponse, playersResponse]) => {
          currentData.teams = teamsResponse.data;
          currentData.players = playersResponse.data;

          const team1Players = getPlayersForTeam(match.teams?.team1?.id || match.team1Id);
          const team2Players = getPlayersForTeam(match.teams?.team2?.id || match.team2Id);

          startMatchScoring(match.id, match, team1Players, team2Players);
        })
        .catch(error => {
          console.error('Error loading data for scoring view:', error);
          showError('matches-content', error);
        });
      } else {
        showEditMatchForm(match);
      }
    }

    function cancelEdit() {
      loadMatches();
    }

    async function deleteMatch(matchId, event) {
      event.stopPropagation();

      if (!confirm('Are you sure you want to delete this match? This action cannot be undone.')) {
        return;
      }

      try {
        await apiCall(`/api/matches/${matchId}`, 'DELETE');

        // Reload all matches from the server to ensure data consistency
        await loadMatches();

        // Show success message
        showSuccess('matches-content', 'Match deleted successfully');

      } catch (error) {
        showError('matches-content', error);
      }
    }

    function editPlayer(playerId, event) {
      event.stopPropagation();

      // Find the player data
      const player = currentData.players.find(p => p.id === playerId);
      if (!player) {
        showError('players-content', new Error('Player not found'));
        return;
      }

      // Populate the form with player data
      document.getElementById('playerName').value = player.name || '';
      document.getElementById('role').value = player.role || 'all-rounder';
      document.getElementById('battingStyle').value = player.battingStyle || '';
      document.getElementById('bowlingStyle').value = player.bowlingStyle || '';
      document.getElementById('teamId').value = player.teamId || '';

      // Update form title and set editing mode
      document.getElementById('players-form-title').textContent = 'Edit Player';
      document.getElementById('players-form-element').setAttribute('data-mode', 'edit');
      document.getElementById('players-form-element').setAttribute('data-player-id', playerId);

      // Show the form
      const playersForm = document.getElementById('players-form');
      const playersContent = document.getElementById('players-content');
      if (playersForm) playersForm.classList.add('active');
      if (playersContent) playersContent.style.display = 'none';
    }

    async function deletePlayer(playerId, event) {
      event.stopPropagation();

      // Find the player data for confirmation
      const player = currentData.players.find(p => p.id === playerId);
      if (!player) {
        showError('players-content', new Error('Player not found'));
        return;
      }

      // Show confirmation dialog
      if (!confirm(`Are you sure you want to delete player "${player.name}"? This will deactivate the player.`)) {
        return;
      }

      try {
        await apiCall(`/api/players/${playerId}`, 'DELETE');
        showSuccess('players-content', `Player "${player.name}" deactivated successfully!`);

        // Reload players list
        await loadPlayers();

      } catch (error) {
        showError('players-content', error);
      }
    }

    function editLineup(lineupId, event) {
      event.stopPropagation();

      // Find the lineup data
      const lineup = currentData.lineups.find(l => l.id === lineupId);
      if (!lineup) {
        showError('lineups-content', new Error('Lineup not found'));
        return;
      }

      // Populate the form with lineup data
      document.getElementById('lineupTeamId').value = lineup.teamId || '';
      document.getElementById('captain').value = lineup.captainId || '';
      document.getElementById('wicketKeeper').value = lineup.wicketKeeperId || '';
      document.getElementById('players').value = (lineup.playerIds || []).join(', ');

      // Update form title and set editing mode
      document.getElementById('lineups-form-title').textContent = 'Edit Team Lineup';
      document.getElementById('lineups-form-element').setAttribute('data-mode', 'edit');
      document.getElementById('lineups-form-element').setAttribute('data-lineup-id', lineupId);

      // Show the form
      const lineupsForm = document.getElementById('lineups-form');
      const lineupsContent = document.getElementById('lineups-content');
      if (lineupsForm) lineupsForm.classList.add('active');
      if (lineupsContent) lineupsContent.style.display = 'none';
    }

    async function deleteLineup(lineupId, event) {
      event.stopPropagation();

      if (!confirm('Are you sure you want to delete this team lineup? This action cannot be undone.')) {
        return;
      }

      try {
        await apiCall(`/api/teamLineups/${lineupId}`, 'DELETE');
        showSuccess('lineups-content', 'Team lineup deleted successfully!');
        await loadLineups(); // Refresh the list
      } catch (error) {
        showError('lineups-content', error);
      }
    }

    // Matches functions
    async function loadMatches() {
      const contentId = 'matches-content';
      showLoading(contentId);

      try {
        const data = await apiCall('/api/matches');
        currentData.matches = data.data;
        displayMatches(data.data, contentId);
      } catch (error) {
        showError(contentId, error);
      }
    }

    function displayMatches(matches, containerId) {
      if (!matches || matches.length === 0) {
        document.getElementById(containerId).innerHTML = '<p>No matches found.</p>';
        return;
      }

      let html = `<p>Found ${matches.length} matches:</p>`;
      html += '<div class="data-grid">';

      matches.forEach(match => {
        const statusClass = match.status === 'live' ? 'status-live' :
                           match.status === 'completed' ? 'status-completed' :
                           match.status === 'scheduled' ? 'status-scheduled' : 'status-upcoming';

        html += `
          <div class="data-card" onclick="showMatchDetail('${match.id}')">
            <h3>${match.title || match.displayId || match.id}</h3>
            <p><span class="status-indicator ${statusClass}"></span>${match.status || 'scheduled'}</p>
            <p><strong>Teams:</strong> ${match.team1 ? match.team1.name : 'TBD'} vs ${match.team2 ? match.team2.name : 'TBD'}</p>
            <p><strong>Score:</strong> ${match.team1Score || 0} - ${match.team2Score || 0}</p>
            <p><strong>Result:</strong> ${match.result || 'N/A'}</p>
            <p><strong>Type:</strong> ${match.matchType || match.title || 'N/A'}</p>
            <p><strong>Venue:</strong> ${match.venue || 'N/A'}</p>
            ${match.scheduledDate ? `<p><strong>Date:</strong> ${new Date(match.scheduledDate).toLocaleString()}</p>` : ''}
            <div class="card-actions">
              <button class="btn btn-small btn-edit" onclick="editMatch('${match.id}', event)">Edit</button>
              <button class="btn btn-small btn-delete" onclick="deleteMatch('${match.id}', event)">Delete</button>
            </div>
          </div>
        `;
      });

      html += '</div>';
      document.getElementById(containerId).innerHTML = html;
    }

    // Load detailed innings data using new API structure
    async function loadMatchInningsData(matchId) {
      try {
        // First get the list of innings for this match
        const inningsListResponse = await fetch(`/api/matches/${matchId}/innings`);
        if (!inningsListResponse.ok) {
          throw new Error('Failed to load innings list');
        }

        const inningsListData = await inningsListResponse.json();
        if (!inningsListData.success || !inningsListData.data) {
          throw new Error('Invalid innings list response');
        }

        const innings = [];

        // For each inning, get the detailed data
        for (const inningSummary of inningsListData.data) {
          try {
            const detailedResponse = await fetch(`/api/matches/${matchId}/innings/${inningSummary.id}`);
            if (detailedResponse.ok) {
              const detailedData = await detailedResponse.json();
              if (detailedData.success && detailedData.data) {
                // Transform the data to match the expected format
                const inning = detailedData.data;
                const match = currentData.matches?.find(m => m.id === matchId);
                const teamName = match?.team1?.id === inning.battingTeam ?
                               match?.team1?.name || 'Team 1' :
                               match?.team2?.name || 'Team 2';

                const transformedInning = {
                  team: teamName,
                  score: `${inning.totalRuns}/${inning.totalWickets}`,
                  overs: `${Math.floor(inning.totalOvers)}.${inning.totalBalls % 6}`,
                  batsmen: inning.batsmen?.map(b => ({
                    name: b.player?.name || `Player ${b.playerId}`,
                    runs: b.runs || 0,
                    balls: b.balls || 0,
                    fours: b.fours || 0,
                    sixes: b.sixes || 0,
                    sr: b.strikeRate || 0,
                    status: b.status || 'not out'
                  })) || [],
                  bowling: inning.bowling?.map(b => ({
                    name: b.player?.name || `Player ${b.playerId}`,
                    overs: b.overs || 0,
                    maidens: b.maidens || 0,
                    runs: b.runs || 0,
                    wickets: b.wickets || 0,
                    economy: b.economy || 0,
                    dots: b.dots || 0,
                    fours: b.fours || 0,
                    sixes: b.sixes || 0
                  })) || [],
                  fall_of_wickets: inning.fallOfWickets?.map(fow => ({
                    wicket_number: fow.wicket || 0,
                    score: fow.score || 0,
                    player_out: fow.playerName || fow.player || 'Unknown',
                    over: fow.over || 0
                  })) || []
                };
                innings.push(transformedInning);
              }
            }
          } catch (error) {
            console.log(`Failed to load detailed data for inning ${inningSummary.id}:`, error);
          }
        }

        return innings.length > 0 ? innings : null;

      } catch (error) {
        console.log('API endpoints not available, trying direct file access');
      }

      // Fallback: try to load from a static JSON endpoint
      try {
        const response = await fetch('/reports/cricket_matches_summary_full.json');
        if (response.ok) {
          const matchesData = await response.json();
          const matchData = matchesData.find(m => m.match_id === matchId || m.match_id === currentData.matches?.find(m => m.id === matchId)?.originalId);
          return matchData ? matchData.innings : null;
        }
      } catch (error) {
        console.log('Could not load innings data from JSON file');
      }

      return null;
    }

    async function showMatchDetail(matchId) {
      const detailDiv = document.getElementById('match-detail');
      detailDiv.style.display = 'block';
      detailDiv.innerHTML = '<div class="loading">Loading match details...</div>';

      try {
        const data = await apiCall(`/api/matches/${matchId}`);
        const match = data.data;

        let html = `<h3>Match Details: ${match.displayId || match.id}</h3>`;
        html += '<div class="detail-grid">';

        // Basic info
        html += `<div class="detail-item"><strong>Status:</strong> ${match.status || 'Unknown'}</div>`;
        html += `<div class="detail-item"><strong>Type:</strong> ${match.matchType || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Venue:</strong> ${match.venue || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Current Innings:</strong> ${match.currentInnings || 'N/A'}</div>`;

        // Teams
        if (match.team1) {
          html += `<div class="detail-item"><strong>Team 1:</strong> ${match.team1.name} (${match.team1.shortName})</div>`;
        }
        if (match.team2) {
          html += `<div class="detail-item"><strong>Team 2:</strong> ${match.team2.name} (${match.team2.shortName})</div>`;
        }

        // Scores
        html += `<div class="detail-item"><strong>Team 1 Score:</strong> ${match.team1Score || 0}</div>`;
        html += `<div class="detail-item"><strong>Team 2 Score:</strong> ${match.team2Score || 0}</div>`;

        // Result
        if (match.winner && match.team1 && match.team2) {
          const winnerName = match.winner === match.team1.id ? match.team1.name :
                           match.winner === match.team2.id ? match.team2.name : 'Unknown';
          html += `<div class="detail-item"><strong>Winner:</strong> ${winnerName}</div>`;
        }
        html += `<div class="detail-item"><strong>Result:</strong> ${match.result || 'N/A'}</div>`;

        html += '</div>';

        // Load detailed innings data from JSON
        try {
          const inningsData = await loadMatchInningsData(matchId);
          if (inningsData && inningsData.length > 0) {
            html += '<h4>Detailed Innings</h4>';

            inningsData.forEach((inning, index) => {
              const inningNumber = index + 1;
              html += `<div class="inning-details">`;
              html += `<h5>Inning ${inningNumber}: ${inning.team} - ${inning.score} (${inning.overs})</h5>`;

              // Batting table
              if (inning.batsmen && inning.batsmen.length > 0) {
                html += '<h6>Batting</h6>';
                html += '<div class="table-container">';
                html += '<table class="innings-table">';
                html += '<tr><th>Batsman</th><th>Runs</th><th>Balls</th><th>4s</th><th>6s</th><th>SR</th><th>Dismissal</th></tr>';

                inning.batsmen.forEach(batsman => {
                  html += `<tr>
                    <td>${batsman.name}</td>
                    <td>${batsman.runs}</td>
                    <td>${batsman.balls}</td>
                    <td>${batsman.fours || 0}</td>
                    <td>${batsman.sixes || 0}</td>
                    <td>${batsman.sr || 'N/A'}</td>
                    <td>${batsman.status}</td>
                  </tr>`;
                });

                html += '</table>';
                html += '</div>';
              }

              // Bowling table
              if (inning.bowling && inning.bowling.length > 0) {
                html += '<h6>Bowling</h6>';
                html += '<div class="table-container">';
                html += '<table class="innings-table">';
                html += '<tr><th>Bowler</th><th>Overs</th><th>Maidens</th><th>Runs</th><th>Wickets</th><th>Econ</th><th>Dots</th><th>4s</th><th>6s</th></tr>';

                inning.bowling.forEach(bowler => {
                  html += `<tr>
                    <td>${bowler.name}</td>
                    <td>${bowler.overs}</td>
                    <td>${bowler.maidens || 0}</td>
                    <td>${bowler.runs}</td>
                    <td>${bowler.wickets}</td>
                    <td>${bowler.economy || 'N/A'}</td>
                    <td>${bowler.dots || 0}</td>
                    <td>${bowler.fours || 0}</td>
                    <td>${bowler.sixes || 0}</td>
                  </tr>`;
                });

                html += '</table>';
                html += '</div>';
              }

              // Fall of wickets
              if (inning.fall_of_wickets && inning.fall_of_wickets.length > 0) {
                html += '<h6>Fall of Wickets</h6>';
                html += '<div class="table-container">';
                html += '<table class="innings-table">';
                html += '<tr><th>Wicket</th><th>Score</th><th>Player Out</th><th>Over</th></tr>';

                inning.fall_of_wickets.forEach(fow => {
                  html += `<tr>
                    <td>${fow.wicket_number}</td>
                    <td>${fow.score}</td>
                    <td>${fow.player_out}</td>
                    <td>${fow.over}</td>
                  </tr>`;
                });

                html += '</table>';
                html += '</div>';
              }

              html += '</div>';
            });
          } else {
            // Fallback to basic innings summary
            if (match.innings && match.innings.length > 0) {
              html += '<h4>Innings Summary</h4>';
              html += '<div class="table-container">';
              html += '<table class="innings-table">';
              html += '<tr><th>Inning</th><th>Runs</th><th>Wickets</th><th>Overs</th><th>Run Rate</th><th>Batting Team</th><th>Bowling Team</th></tr>';

              match.innings.forEach(inning => {
                const battingTeam = match.team1 && match.team1.id === inning.battingTeam ? match.team1.name :
                                  match.team2 && match.team2.id === inning.battingTeam ? match.team2.name : inning.battingTeam;
                const bowlingTeam = match.team1 && match.team1.id === inning.bowlingTeam ? match.team1.name :
                                  match.team2 && match.team2.id === inning.bowlingTeam ? match.team2.name : inning.bowlingTeam;

                html += `<tr>
                  <td>${inning.id}</td>
                  <td>${inning.totalRuns}</td>
                  <td>${inning.totalWickets}</td>
                  <td>${inning.totalOvers}</td>
                  <td>${inning.runRate ? inning.runRate.toFixed(2) : 'N/A'}</td>
                  <td>${battingTeam}</td>
                  <td>${bowlingTeam}</td>
                </tr>`;
              });

              html += '</table>';
              html += '</div>';
            }
          }
        } catch (inningsError) {
          console.error('Error loading innings data:', inningsError);
          // Fallback to basic innings summary
          if (match.innings && match.innings.length > 0) {
            html += '<h4>Innings Summary</h4>';
            html += '<div class="table-container">';
            html += '<table class="innings-table">';
            html += '<tr><th>Inning</th><th>Runs</th><th>Wickets</th><th>Overs</th><th>Run Rate</th><th>Batting Team</th><th>Bowling Team</th></tr>';

            match.innings.forEach(inning => {
              const battingTeam = match.team1 && match.team1.id === inning.battingTeam ? match.team1.name :
                                match.team2 && match.team2.id === inning.battingTeam ? match.team2.name : inning.battingTeam;
              const bowlingTeam = match.team1 && match.team1.id === inning.bowlingTeam ? match.team1.name :
                                match.team2 && match.team2.id === inning.bowlingTeam ? match.team2.name : inning.bowlingTeam;

              html += `<tr>
                <td>${inning.id}</td>
                <td>${inning.totalRuns}</td>
                <td>${inning.totalWickets}</td>
                <td>${inning.totalOvers}</td>
                <td>${inning.runRate ? inning.runRate.toFixed(2) : 'N/A'}</td>
                <td>${battingTeam}</td>
                <td>${bowlingTeam}</td>
              </tr>`;
            });

            html += '</table>';
            html += '</div>';
          }
        }

        html += '<br><button class="btn btn-secondary" onclick="hideMatchDetail()">Close Details</button>';

        detailDiv.innerHTML = html;
        detailDiv.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        detailDiv.innerHTML = `<div class="error">Error loading match details: ${error.message}</div>`;
      }
    }

    function hideMatchDetail() {
      document.getElementById('match-detail').style.display = 'none';
    }

    // Teams functions
    async function loadTeams() {
      const contentId = 'teams-content';
      showLoading(contentId);

      try {
        const data = await apiCall('/api/teams');
        currentData.teams = data.data;
        displayTeams(data.data, contentId);
      } catch (error) {
        showError(contentId, error);
      }
    }

    function displayTeams(teams, containerId) {
      if (!teams || teams.length === 0) {
        document.getElementById(containerId).innerHTML = '<p>No teams found.</p>';
        return;
      }

      let html = `<p>Found ${teams.length} teams:</p>`;
      html += '<div class="data-grid">';

      teams.forEach(team => {
        html += `
          <div class="data-card" onclick="showTeamDetail('${team.id}')">
            <h3>${team.name}</h3>
            <p><strong>Short Name:</strong> ${team.shortName || 'N/A'}</p>
            <p><strong>ID:</strong> ${team.displayId || team.id}</p>
            <p><strong>Players:</strong> ${team.playersCount || 0}</p>
            <div class="card-actions">
              <button class="btn btn-small btn-edit" onclick="editTeam('${team.id}', event)">Edit</button>
              <button class="btn btn-small btn-delete" onclick="deleteTeam('${team.id}', event)">Delete</button>
            </div>
          </div>
        `;
      });

      html += '</div>';
      document.getElementById(containerId).innerHTML = html;
    }

    async function showTeamDetail(teamId) {
      const detailDiv = document.getElementById('team-detail');
      detailDiv.style.display = 'block';
      detailDiv.innerHTML = '<div class="loading">Loading team details...</div>';

      try {
        const data = await apiCall(`/api/teams/${teamId}`);
        const team = data.data;

        let html = `<h3>Team Details: ${team.name}</h3>`;
        html += '<div class="detail-grid">';

        html += `<div class="detail-item"><strong>Name:</strong> ${team.name}</div>`;
        html += `<div class="detail-item"><strong>Short Name:</strong> ${team.shortName || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>ID:</strong> ${team.displayId || team.id}</div>`;
        html += `<div class="detail-item"><strong>Created:</strong> ${team.createdAt ? new Date(team.createdAt).toLocaleDateString() : 'N/A'}</div>`;

        html += '</div>';

        html += '<br><button class="btn btn-secondary" onclick="hideTeamDetail()">Close Details</button>';

        detailDiv.innerHTML = html;
        detailDiv.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        detailDiv.innerHTML = `<div class="error">Error loading team details: ${error.message}</div>`;
      }
    }

    function hideTeamDetail() {
      document.getElementById('team-detail').style.display = 'none';
    }

    // Players functions
    async function loadPlayers() {
      const contentId = 'players-content';
      showLoading(contentId);

      try {
        const data = await apiCall('/api/players');
        currentData.players = data.data;
        displayPlayers(data.data, contentId);
      } catch (error) {
        showError(contentId, error);
      }
    }

    function displayPlayers(players, containerId) {
      if (!players || players.length === 0) {
        document.getElementById(containerId).innerHTML = '<p>No players found.</p>';
        return;
      }

      let html = `<p>Found ${players.length} players:</p>`;
      
      // Add filter controls
      html += '<div class="filter-controls" style="margin-bottom: 20px;">';
      html += '<label for="player-status-filter" style="margin-right: 10px;"><strong>Filter by Status:</strong></label>';
      html += '<select id="player-status-filter" onchange="filterPlayersByStatus()">';
      html += '<option value="all">All Players</option>';
      html += '<option value="active">Active Only</option>';
      html += '<option value="suspended">Suspended Only</option>';
      html += '</select>';
      html += '</div>';
      
      html += '<div class="merge-actions" id="merge-actions" style="display: none;">';
      html += '<button class="btn btn-warning" onclick="showMergeModal()">Merge Selected Players</button>';
      html += '<button class="btn btn-secondary" onclick="clearSelection()">Clear Selection</button>';
      html += '<button class="btn" onclick="alert(\'Test button works!\')">Test Button</button>';
      html += '<span id="selection-count">0 players selected</span>';
      html += '</div>';
      html += '<div class="data-grid">';

      players.forEach(player => {
        const status = player.isActive === false ? 'Suspended' : 'Active';
        const statusClass = player.isActive === false ? 'status-suspended' : 'status-active';
        
        html += `
          <div class="data-card ${statusClass}" onclick="showPlayerDetail('${player.id}')">
            <div class="card-checkbox">
              <input type="checkbox" id="player-${player.id}" onchange="togglePlayerSelection('${player.id}')" onclick="event.stopPropagation(); console.log('Checkbox clicked for ${player.id}')">
            </div>
            <h3>${player.name}</h3>
            <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${status}</span></p>
            <p><strong>Role:</strong> ${player.role || 'N/A'}</p>
            <p><strong>ID:</strong> ${player.displayId || player.id}</p>
            <p><strong>Team:</strong> ${player.teamName || 'N/A'}</p>
            <p><strong>Matches:</strong> ${player.matchesPlayed || 0}</p>
            <p><strong>Runs:</strong> ${player.totalRuns || 0} | <strong>Wickets:</strong> ${player.totalWickets || 0}</p>
            <p><strong>Overs Bowled:</strong> ${player.oversBowled || 0} | <strong>Runs Conceded:</strong> ${player.runsConceded || 0}</p>
            <p><strong>Batting Avg:</strong> ${player.battingAverage ? player.battingAverage.toFixed(2) : 'N/A'} | <strong>Bowling Avg:</strong> ${player.bowlingAverage ? player.bowlingAverage.toFixed(2) : 'N/A'}</p>
            <p><strong>Strike Rate:</strong> ${player.battingStrikeRate ? player.battingStrikeRate.toFixed(2) : 'N/A'} | <strong>Economy:</strong> ${player.bowlingEconomy ? player.bowlingEconomy.toFixed(2) : 'N/A'}</p>
            <div class="card-actions">
              <button class="btn btn-small btn-edit" onclick="editPlayer('${player.id}', event)">Edit</button>
              <button class="btn btn-small btn-delete" onclick="deletePlayer('${player.id}', event)">Delete</button>
            </div>
          </div>
        `;
      });

      html += '</div>';
      document.getElementById(containerId).innerHTML = html;
    }

    async function showPlayerDetail(playerId) {
      const detailDiv = document.getElementById('player-detail');
      detailDiv.style.display = 'block';
      detailDiv.innerHTML = '<div class="loading">Loading player details...</div>';

      try {
        // Get basic player info
        const playerData = await apiCall(`/api/players/${playerId}`);
        const player = playerData.data;

        // Get detailed match performance
        const matchData = await apiCall(`/api/players/${playerId}/matches`);
        const matchDetails = matchData.data;
        
        console.log('Player match data:', matchDetails);
        console.log('Matches array:', matchDetails.matches);
        console.log('Matches length:', matchDetails.matches ? matchDetails.matches.length : 'undefined');

        let html = `<h3>Player Details: ${player.name}</h3>`;
        html += '<div class="detail-grid">';

        html += `<div class="detail-item"><strong>Name:</strong> ${player.name}</div>`;
        html += `<div class="detail-item"><strong>Role:</strong> ${player.role || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>ID:</strong> ${player.displayId || player.id}</div>`;
        html += `<div class="detail-item"><strong>Team:</strong> ${player.teamName || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Batting Style:</strong> ${player.battingStyle || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Bowling Style:</strong> ${player.bowlingStyle || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Matches Played:</strong> ${matchDetails.summary.totalMatches}</div>`;
        html += `<div class="detail-item"><strong>Total Runs:</strong> ${matchDetails.summary.totalRuns}</div>`;
        html += `<div class="detail-item"><strong>Total Wickets:</strong> ${matchDetails.summary.totalWickets}</div>`;
        html += `<div class="detail-item"><strong>Total Catches:</strong> ${matchDetails.summary.totalCatches}</div>`;

        if (player.battingAverage) {
          html += `<div class="detail-item"><strong>Batting Average:</strong> ${player.battingAverage.toFixed(2)}</div>`;
        }
        if (player.bowlingAverage) {
          html += `<div class="detail-item"><strong>Bowling Average:</strong> ${player.bowlingAverage.toFixed(2)}</div>`;
        }
        if (player.battingStrikeRate) {
          html += `<div class="detail-item"><strong>Batting Strike Rate:</strong> ${player.battingStrikeRate.toFixed(2)}</div>`;
        }
        if (player.bowlingEconomy) {
          html += `<div class="detail-item"><strong>Bowling Economy:</strong> ${player.bowlingEconomy.toFixed(2)}</div>`;
        }

        html += '</div>';

        // Match Performance Details
        if (matchDetails.matches && matchDetails.matches.length > 0) {
          html += '<h4>Match Performance Details</h4>';
          html += '<div class="matches-table-container">';
          html += '<table class="data-table">';
          html += '<thead>';
          html += '<tr>';
          html += '<th>Date</th>';
          html += '<th>Match</th>';
          html += '<th>Batting</th>';
          html += '<th>Bowling</th>';
          html += '<th>Fielding</th>';
          html += '</tr>';
          html += '</thead>';
          html += '<tbody>';

          for (const match of matchDetails.matches) {
            // Handle different date formats
            let matchDate = 'N/A';
            if (match.matchDate) {
              if (typeof match.matchDate === 'object' && match.matchDate.seconds) {
                // Firestore timestamp
                matchDate = new Date(match.matchDate.seconds * 1000).toLocaleDateString();
              } else if (typeof match.matchDate === 'object' && match.matchDate._seconds) {
                // Firestore timestamp with _seconds
                matchDate = new Date(match.matchDate._seconds * 1000).toLocaleDateString();
              } else if (typeof match.matchDate === 'string') {
                // ISO string or other string format
                matchDate = new Date(match.matchDate).toLocaleDateString();
              }
            }
            
            const matchTitle = `${match.team1 || 'Team 1'} vs ${match.team2 || 'Team 2'}`;

            // Parse contributions array to extract batting, bowling, and fielding data
            let battingInfo = '-';
            let bowlingInfo = '-';
            let fieldingInfo = '-';

            if (match.contributions && Array.isArray(match.contributions)) {
              // Aggregate batting contributions
              const battingContributions = match.contributions.filter(c => c.type === 'batting');
              if (battingContributions.length > 0) {
                const totalRuns = battingContributions.reduce((sum, c) => sum + (c.runs || 0), 0);
                const totalBalls = battingContributions.reduce((sum, c) => sum + (c.balls || 0), 0);
                const dismissals = battingContributions.map(c => c.dismissal).filter(d => d && d !== 'not out');
                battingInfo = `${totalRuns}(${totalBalls})`;
                if (dismissals.length > 0) {
                  battingInfo += '*';
                }
              }

              // Aggregate bowling contributions
              const bowlingContributions = match.contributions.filter(c => c.type === 'bowling');
              if (bowlingContributions.length > 0) {
                const totalOvers = bowlingContributions.reduce((sum, c) => sum + (parseFloat(c.overs) || 0), 0);
                const totalMaidens = bowlingContributions.reduce((sum, c) => sum + (c.maidens || 0), 0);
                const totalRuns = bowlingContributions.reduce((sum, c) => sum + (c.runs || 0), 0);
                const totalWickets = bowlingContributions.reduce((sum, c) => sum + (c.wickets || 0), 0);
                bowlingInfo = `${totalOvers.toFixed(1)}-${totalMaidens}-${totalRuns}-${totalWickets}`;
              }

              // Aggregate fielding contributions
              const fieldingContributions = match.contributions.filter(c => c.type === 'fielding' && c.action === 'catch');
              if (fieldingContributions.length > 0) {
                const totalCatches = fieldingContributions.reduce((sum, c) => sum + (c.count || 0), 0);
                if (totalCatches > 0) {
                  fieldingInfo = `${totalCatches} catch${totalCatches > 1 ? 'es' : ''}`;
                }
              }
            }

            html += '<tr>';
            html += `<td>${matchDate}</td>`;
            html += `<td>${matchTitle}</td>`;
            html += `<td>${battingInfo}</td>`;
            html += `<td>${bowlingInfo}</td>`;
            html += `<td>${fieldingInfo}</td>`;
            html += '</tr>';
          }

          html += '</tbody>';
          html += '</table>';
          html += '</div>';
        } else {
          html += '<p>No match data available for this player.</p>';
        }

        html += '<br><button class="btn btn-secondary" onclick="hidePlayerDetail()">Close Details</button>';

        detailDiv.innerHTML = html;
        detailDiv.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        detailDiv.innerHTML = `<div class="error">Error loading player details: ${error.message}</div>`;
      }
    }

    function hidePlayerDetail() {
      document.getElementById('player-detail').style.display = 'none';
    }

    async function recalculatePlayerStats() {
      console.log('🔄 recalculatePlayerStats called');

      // First, get the preview mapping
      const contentId = 'players-content';
      showLoading(contentId, 'Getting player mapping preview...');

      try {
        console.log('📡 Making API call to /api/players/preview-recalculate-stats');
        const previewResult = await apiCall('/api/players/preview-recalculate-stats', 'GET');
        console.log('📊 Preview result:', previewResult);

        // Transform API response to expected format
        const transformedStats = {
          playerMapping: previewResult.data.playerMapping,
          databasePlayers: [], // We'll populate this from playerMapping
          jsonPlayers: [], // We'll populate this from playerMapping
          playersInDatabase: previewResult.data.totalPlayersInDatabase,
          jsonPlayersFound: previewResult.data.playerMapping.length,
          matchesProcessed: previewResult.data.matchesProcessed
        };

        // Extract unique database players from mapping
        const dbPlayerMap = new Map();
        previewResult.data.playerMapping.forEach(mapping => {
          if (mapping.databasePlayerId && !dbPlayerMap.has(mapping.databasePlayerId)) {
            dbPlayerMap.set(mapping.databasePlayerId, {
              id: mapping.databasePlayerId,
              name: mapping.databasePlayerName,
              numericId: mapping.databasePlayerId, // Assuming ID is numeric for display
              role: 'N/A' // We don't have role info in mapping
            });
          }
        });
        transformedStats.databasePlayers = Array.from(dbPlayerMap.values());

        // Extract unique JSON players from mapping
        const jsonPlayerMap = new Map();
        previewResult.data.playerMapping.forEach(mapping => {
          if (!jsonPlayerMap.has(mapping.matchPlayerName)) {
            // Find if there's a suggested match
            const suggestedMatch = previewResult.data.playerMapping.find(m => 
              m.matchPlayerName === mapping.matchPlayerName && m.databasePlayerId
            );
            
            jsonPlayerMap.set(mapping.matchPlayerName, {
              name: mapping.matchPlayerName,
              matchCount: mapping.matchCount,
              suggestedMatch: suggestedMatch ? {
                id: suggestedMatch.databasePlayerId,
                name: suggestedMatch.databasePlayerName
              } : null
            });
          }
        });
        transformedStats.jsonPlayers = Array.from(jsonPlayerMap.values());

        // Show preview modal
        showRecalculationPreviewModal(transformedStats);

      } catch (error) {
        console.error('❌ Preview failed:', error);
        showError(contentId, error);
      }
    }

    function showRecalculationPreviewModal(stats) {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.id = 'recalculation-preview-modal';

      const matched = stats.playerMapping.filter(p => p.status === 'matched');
      const unmatched = stats.playerMapping.filter(p => p.status === 'unmatched');

      let html = `
        <div class="modal-content" style="max-width: 1400px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>📊 Player Statistics Recalculation - Manual Mapping</h3>
            <span class="modal-close" onclick="closeRecalculationPreviewModal()">&times;</span>
          </div>
          <div class="modal-body">
            <div class="preview-summary">
              <div class="summary-item">
                <strong>Matches to Process:</strong> ${stats.matchesProcessed}
              </div>
              <div class="summary-item">
                <strong>Players in Database:</strong> ${stats.playersInDatabase}
              </div>
              <div class="summary-item">
                <strong>Players in Match Data:</strong> ${stats.jsonPlayersFound}
              </div>
              <div class="summary-item">
                <strong>Auto-Matched:</strong> <span style="color: #28a745;">${matched.length}</span>
              </div>
              <div class="summary-item">
                <strong>Need Manual Mapping:</strong> <span style="color: #ffc107;">${unmatched.length}</span>
              </div>
            </div>

            <div class="mapping-interface">
              <div class="mapping-instructions">
                <h4>How to Map Players:</h4>
                <ul>
                  <li><strong>Auto-matched players</strong> are already linked (green background)</li>
                  <li><strong>Click on unmatched JSON players</strong> to select them</li>
                  <li><strong>Click on database players</strong> to map the selected JSON player to them</li>
                  <li><strong>Unmapped players</strong> will be skipped during recalculation</li>
                  <li><strong>Suggested matches</strong> are shown with dashed borders</li>
                </ul>
              </div>

              <div class="mapping-columns">
                <div class="mapping-column">
                  <h4>📋 Database Players (${stats.databasePlayers.length})</h4>
                  <div class="player-list" id="database-players-list">`;

      // Database players list
      stats.databasePlayers.forEach(player => {
        const isMapped = stats.playerMapping.some(m => m.databasePlayerId === player.id && m.status === 'matched');
        const mappingClass = isMapped ? 'mapped-player' : 'unmapped-player';
        html += `<div class="player-card ${mappingClass}" data-player-id="${player.id}" onclick="selectDatabasePlayer('${player.id}')">
                    <div class="player-name">${player.name}</div>
                    <div class="player-details">
                      ID: ${player.numericId || player.id} |
                      Role: ${player.role || 'N/A'}
                    </div>
                  </div>`;
      });

      html += `</div>
                </div>

                <div class="mapping-column">
                  <h4>📄 JSON Match Players (${stats.jsonPlayers.length})</h4>
                  <div class="player-list" id="json-players-list">`;

      // JSON players list
      stats.jsonPlayers.forEach(jsonPlayer => {
        const isMapped = jsonPlayer.suggestedMatch !== null;
        const mappingClass = isMapped ? 'suggested-match' : 'unmapped-player';
        const suggestedDbId = jsonPlayer.suggestedMatch ? jsonPlayer.suggestedMatch.id : '';
        html += `<div class="player-card ${mappingClass}" data-json-name="${jsonPlayer.name}" data-suggested-db="${suggestedDbId}" onclick="selectJsonPlayer('${jsonPlayer.name}')">
                    <div class="player-name">${jsonPlayer.name}</div>
                    <div class="player-details">
                      Matches: ${jsonPlayer.matchCount}
                      ${jsonPlayer.suggestedMatch ? `<br>Suggested: ${jsonPlayer.suggestedMatch.name}` : ''}
                    </div>
                  </div>`;
      });

      html += `</div>
                </div>
              </div>

              <div class="mapping-actions">
                <button class="btn btn-secondary" onclick="clearAllMappings()">Clear All Mappings</button>
                <button class="btn btn-info" onclick="autoMapSuggested()">Auto-Map Suggested</button>
                <div class="mapping-status">
                  <span id="mapping-status">Selected: None</span>
                </div>
              </div>

              <div class="current-mappings">
                <h4>Current Mappings (${matched.length})</h4>
                <div id="current-mappings-list">`;

      // Show current mappings
      matched.forEach(mapping => {
        html += `<div class="mapping-item">
                    <span class="json-player">${mapping.matchPlayerName}</span>
                    <span class="arrow">→</span>
                    <span class="db-player">${mapping.databasePlayerName}</span>
                    <button class="btn-small btn-danger" onclick="removeMapping('${mapping.matchPlayerName}')">Remove</button>
                  </div>`;
      });

      html += `</div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeRecalculationPreviewModal()">Cancel</button>
            <button class="btn btn-success" onclick="proceedWithRecalculation()">
              Proceed with Recalculation (${matched.length} players will be updated)
            </button>
          </div>
        </div>
      `;

      modal.innerHTML = html;
      document.body.appendChild(modal);

      // Store the preview data for later use
      window.recalculationPreviewData = stats;
      window.currentMappings = new Map(); // jsonPlayerName -> databasePlayerId

      // Initialize mappings from auto-matched players
      matched.forEach(mapping => {
        window.currentMappings.set(mapping.matchPlayerName, mapping.databasePlayerId);
      });

      // Initialize selected players
      window.selectedJsonPlayer = null;
      window.selectedDatabasePlayer = null;
    }

    function closeRecalculationPreviewModal() {
      const modal = document.getElementById('recalculation-preview-modal');
      if (modal) {
        modal.remove();
      }
      delete window.recalculationPreviewData;
      delete window.currentMappings;
      delete window.selectedJsonPlayer;
      delete window.selectedDatabasePlayer;
    }

    // Player mapping functions
    function selectJsonPlayer(jsonPlayerName) {
      // Clear previous selection
      document.querySelectorAll('.player-card.selected-json').forEach(card => {
        card.classList.remove('selected-json');
      });

      // Select new JSON player
      const jsonCard = document.querySelector(`[data-json-name="${jsonPlayerName}"]`);
      if (jsonCard) {
        jsonCard.classList.add('selected-json');
        window.selectedJsonPlayer = jsonPlayerName;
        updateMappingStatus();
      }
    }

    function selectDatabasePlayer(databasePlayerId) {
      if (!window.selectedJsonPlayer) {
        alert('Please select a JSON player first');
        return;
      }

      // Create the mapping
      window.currentMappings.set(window.selectedJsonPlayer, databasePlayerId);

      // Update UI
      updateMappingsDisplay();
      updatePlayerCardStyles();

      // Clear selection
      document.querySelectorAll('.player-card.selected-json').forEach(card => {
        card.classList.remove('selected-json');
      });
      window.selectedJsonPlayer = null;
      updateMappingStatus();
    }

    function removeMapping(jsonPlayerName) {
      window.currentMappings.delete(jsonPlayerName);
      updateMappingsDisplay();
      updatePlayerCardStyles();
    }

    function clearAllMappings() {
      if (confirm('Are you sure you want to clear all manual mappings? Auto-matched players will remain.')) {
        // Keep only auto-matched mappings
        const autoMatched = new Map();
        const stats = window.recalculationPreviewData;
        const matched = stats.playerMapping.filter(p => p.status === 'matched');
        matched.forEach(mapping => {
          autoMatched.set(mapping.matchPlayerName, mapping.databasePlayerId);
        });
        window.currentMappings = autoMatched;
        updateMappingsDisplay();
        updatePlayerCardStyles();
      }
    }

    function autoMapSuggested() {
      const stats = window.recalculationPreviewData;
      stats.jsonPlayers.forEach(jsonPlayer => {
        if (jsonPlayer.suggestedMatch && !window.currentMappings.has(jsonPlayer.name)) {
          window.currentMappings.set(jsonPlayer.name, jsonPlayer.suggestedMatch.id);
        }
      });
      updateMappingsDisplay();
      updatePlayerCardStyles();
    }

    function updateMappingStatus() {
      const statusEl = document.getElementById('mapping-status');
      if (window.selectedJsonPlayer) {
        statusEl.textContent = `Selected: ${window.selectedJsonPlayer} - Click a database player to map`;
        statusEl.style.color = '#007bff';
      } else {
        statusEl.textContent = 'Selected: None';
        statusEl.style.color = '#6c757d';
      }
    }

    function updateMappingsDisplay() {
      const mappingsList = document.getElementById('current-mappings-list');
      const stats = window.recalculationPreviewData;

      let html = '';
      let count = 0;

      window.currentMappings.forEach((dbPlayerId, jsonPlayerName) => {
        const dbPlayer = stats.databasePlayers.find(p => p.id === dbPlayerId);
        if (dbPlayer) {
          html += `<div class="mapping-item">
                      <span class="json-player">${jsonPlayerName}</span>
                      <span class="arrow">→</span>
                      <span class="db-player">${dbPlayer.name}</span>
                      <button class="btn-small btn-danger" onclick="removeMapping('${jsonPlayerName}')">Remove</button>
                    </div>`;
          count++;
        }
      });

      mappingsList.innerHTML = html;

      // Update the header count
      const header = mappingsList.previousElementSibling;
      header.textContent = `Current Mappings (${count})`;

      // Update proceed button
      const proceedBtn = document.querySelector('#recalculation-preview-modal .btn-success');
      if (proceedBtn) {
        proceedBtn.textContent = `Proceed with Recalculation (${count} players will be updated)`;
      }
    }

    function updatePlayerCardStyles() {
      // Update database player cards
      document.querySelectorAll('#database-players-list .player-card').forEach(card => {
        const playerId = card.dataset.playerId;
        const isMapped = Array.from(window.currentMappings.values()).includes(playerId);
        card.classList.toggle('mapped-player', isMapped);
        card.classList.toggle('unmapped-player', !isMapped);
      });

      // Update JSON player cards
      document.querySelectorAll('#json-players-list .player-card').forEach(card => {
        const jsonName = card.dataset.jsonName;
        const isMapped = window.currentMappings.has(jsonName);
        card.classList.toggle('mapped-player', isMapped);
        card.classList.toggle('unmapped-player', !isMapped);
      });
    }

    async function proceedWithRecalculation() {
      closeRecalculationPreviewModal();

      if (!confirm('This will update statistics for all mapped players. Continue?')) {
        return;
      }

      const contentId = 'players-content';
      showLoading(contentId);

      try {
        console.log('📡 Making API call to /api/players/recalculate-stats');

        // Send custom mappings if they exist
        const requestBody = {};
        if (window.currentMappings && window.currentMappings.size > 0) {
          requestBody.customMappings = Object.fromEntries(window.currentMappings);
        }

        const result = await apiCall('/api/players/recalculate-stats', 'POST', requestBody);
        console.log('📊 Recalculation result:', result);

        // Display success message with mapping
        let message = `Statistics recalculated successfully! Updated ${result.data.playersUpdated} players with data from ${result.data.matchesProcessed} matches.`;
        message += `<br><br><strong>Player Mapping Summary:</strong>`;
        message += `<br>• Total players in database: ${result.data.totalPlayersInDatabase}`;
        message += `<br>• Players with updated statistics: ${result.data.playersUpdated}`;

        // Create detailed mapping display
        if (result.data.playerMapping && result.data.playerMapping.length > 0) {
          const matched = result.data.playerMapping.filter(p => p.status === 'matched');
          const unmatched = result.data.playerMapping.filter(p => p.status === 'unmatched');

          message += `<br>• Players matched from match data: ${matched.length}`;
          message += `<br>• Players from match data with no database match: ${unmatched.length}`;

          // Add detailed mapping table
          message += `<br><br><div class="player-mapping-container">`;
          message += `<h4>Player Statistics Mapping Details</h4>`;
          message += `<div class="mapping-tabs">`;
          message += `<button class="mapping-tab active" onclick="showMappingTab('matched')">Matched Players (${matched.length})</button>`;
          message += `<button class="mapping-tab" onclick="showMappingTab('unmatched')">Unmatched Players (${unmatched.length})</button>`;
          message += `</div>`;

          message += `<div id="matched-mapping" class="mapping-content active">`;
          message += `<div class="table-container">`;
          message += `<table class="mapping-table">`;
          message += `<thead><tr><th>Match Player Name</th><th>Database Player</th><th>Match Appearances</th></tr></thead>`;
          message += `<tbody>`;
          matched.slice(0, 50).forEach(player => { // Show first 50 to avoid overwhelming display
            message += `<tr>`;
            message += `<td>${player.matchPlayerName}</td>`;
            message += `<td>${player.databasePlayerName} (${player.databasePlayerId})</td>`;
            message += `<td>${player.matchCount}</td>`;
            message += `</tr>`;
          });
          if (matched.length > 50) {
            message += `<tr><td colspan="3"><em>... and ${matched.length - 50} more matched players</em></td></tr>`;
          }
          message += `</tbody></table></div></div>`;

          message += `<div id="unmatched-mapping" class="mapping-content">`;
          message += `<div class="table-container">`;
          message += `<table class="mapping-table">`;
          message += `<thead><tr><th>Match Player Name</th><th>Status</th><th>Match Appearances</th></tr></thead>`;
          message += `<tbody>`;
          unmatched.slice(0, 50).forEach(player => { // Show first 50
            message += `<tr>`;
            message += `<td>${player.matchPlayerName}</td>`;
            message += `<td><span class="status-unmatched">No match found</span></td>`;
            message += `<td>${player.matchCount}</td>`;
            message += `</tr>`;
          });
          if (unmatched.length > 50) {
            message += `<tr><td colspan="3"><em>... and ${unmatched.length - 50} more unmatched players</em></td></tr>`;
          }
          message += `</tbody></table></div></div>`;

          message += `</div>`;
        }

        showSuccess(contentId, message);
        loadPlayers(); // Refresh the list
      } catch (error) {
        console.error('❌ Recalculation failed:', error);
        showError(contentId, error);
      }
    }

    // Lineups functions
    async function loadLineups() {
      const contentId = 'lineups-content';
      showLoading(contentId);

      try {
        const data = await apiCall('/api/teamLineups');
        currentData.lineups = data.data;
        displayLineups(data.data, contentId);
      } catch (error) {
        showError(contentId, error);
      }
    }

    function displayLineups(lineups, containerId) {
      if (!lineups || lineups.length === 0) {
        document.getElementById(containerId).innerHTML = '<p>No lineups found.</p>';
        return;
      }

      let html = `<p>Found ${lineups.length} team lineups:</p>`;
      html += '<div class="data-grid">';

      lineups.forEach(lineup => {
        html += `
          <div class="data-card" onclick="showLineupDetail('${lineup.id}')">
            <h3>${lineup.teamName || 'Unknown Team'}</h3>
            <p><strong>Players:</strong> ${lineup.playersCount || 0}</p>
            <p><strong>Captain:</strong> ${lineup.captainName || 'N/A'}</p>
            <p><strong>Wicket Keeper:</strong> ${lineup.wicketKeeperName || 'N/A'}</p>
            <div class="card-actions">
              <button class="btn btn-small btn-edit" onclick="editLineup('${lineup.id}', event)">Edit</button>
              <button class="btn btn-small btn-delete" onclick="deleteLineup('${lineup.id}', event)">Delete</button>
            </div>
          </div>
        `;
      });

      html += '</div>';
      document.getElementById(containerId).innerHTML = html;
    }

    async function showLineupDetail(lineupId) {
      const detailDiv = document.getElementById('lineup-detail');
      detailDiv.style.display = 'block';
      detailDiv.innerHTML = '<div class="loading">Loading lineup details...</div>';

      try {
        const data = await apiCall(`/api/teamLineups/${lineupId}`);
        const lineup = data.data;

        let html = `<h3>Lineup Details: ${lineup.teamName || 'Unknown Team'}</h3>`;
        html += '<div class="detail-grid">';

        html += `<div class="detail-item"><strong>Team:</strong> ${lineup.teamName || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Players Count:</strong> ${lineup.playersCount || 0}</div>`;
        html += `<div class="detail-item"><strong>Captain:</strong> ${lineup.captainName || 'N/A'}</div>`;
        html += `<div class="detail-item"><strong>Wicket Keeper:</strong> ${lineup.wicketKeeperName || 'N/A'}</div>`;

        html += '</div>';

        html += '<br><button class="btn btn-secondary" onclick="hideLineupDetail()">Close Details</button>';

        detailDiv.innerHTML = html;
        detailDiv.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        detailDiv.innerHTML = `<div class="error">Error loading lineup details: ${error.message}</div>`;
      }
    }

    function hideLineupDetail() {
      document.getElementById('lineup-detail').style.display = 'none';
    }

    // Player mapping tab switching
    function showMappingTab(tabName) {
      // Hide all mapping content
      const contents = document.querySelectorAll('.mapping-content');
      contents.forEach(content => content.classList.remove('active'));

      // Remove active class from all tabs
      const tabs = document.querySelectorAll('.mapping-tab');
      tabs.forEach(tab => tab.classList.remove('active'));

      // Show selected content and activate tab
      document.getElementById(tabName + '-mapping').classList.add('active');
      event.target.classList.add('active');
    }

    // Match scoring functions
    async function loadTeamPlayers(teamPrefix) {
      const teamId = document.getElementById(teamPrefix + 'Id').value.trim();
      if (!teamId) {
        alert('Please enter a team ID first');
        return;
      }

      const playerListDiv = document.getElementById(teamPrefix + '-players');
      playerListDiv.innerHTML = '<div class="loading">Loading players...</div>';

      try {
        // For now, load all players and filter by teamId
        // TODO: Add team filtering to players API
        const result = await apiCall('/api/players');
        const allPlayers = result.data;

        // Filter players by teamId (assuming players have teamId field)
        const teamPlayers = allPlayers.filter(player => player.teamId === teamId);

        if (teamPlayers.length === 0) {
          playerListDiv.innerHTML = '<p>No players found for this team. Players will be selectable from all available players.</p>';
          // Show all players as selectable
          displayPlayerSelectionList(playerListDiv, allPlayers, teamPrefix);
        } else {
          displayPlayerSelectionList(playerListDiv, teamPlayers, teamPrefix);
        }

      } catch (error) {
        console.error('Failed to load team players:', error);
        playerListDiv.innerHTML = '<p class="error">Failed to load players</p>';
      }
    }

    function displayPlayerSelectionList(container, players, teamPrefix) {
      if (!players || players.length === 0) {
        container.innerHTML = '<p>No players available</p>';
        return;
      }

      let html = '';
      players.forEach(player => {
        const checkboxId = `${teamPrefix}-player-${player.id}`;
        html += `
          <div class="player-checkbox-item">
            <input type="checkbox" id="${checkboxId}" value="${player.id}" onchange="updatePlayerSelection('${teamPrefix}')">
            <div class="player-info">
              <div class="player-name">${player.name}</div>
              <div class="player-role">${player.role || 'N/A'} • ID: ${player.displayId || player.id}</div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function updatePlayerSelection(teamPrefix) {
      // Could add validation or limits here
      const selectedCount = getSelectedPlayers(teamPrefix).length;
      console.log(`${teamPrefix} selected players: ${selectedCount}`);
    }

    function getSelectedPlayers(teamPrefix) {
      const checkboxes = document.querySelectorAll(`#${teamPrefix}-players input[type="checkbox"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    async function startMatchScoring(matchId, matchData, team1Players, team2Players) {
      // Hide the form and show scoring interface
      hideCreateForm('matches');

      // Ensure players are loaded
      if (!currentData.players || currentData.players.length === 0) {
        try {
          const data = await apiCall('/api/players');
          currentData.players = data.data;
        } catch (error) {
          console.error('Failed to load players:', error);
          showError('matches-content', new Error('Failed to load players for scoring interface'));
          return;
        }
      }

      // Create scoring interface
      const scoringHtml = createScoringInterface(matchId, matchData, team1Players, team2Players);
      document.getElementById('matches-content').innerHTML = scoringHtml;

      // Initialize scoring state
      window.currentMatch = {
        id: matchId,
        data: matchData,
        team1Players: team1Players,
        team2Players: team2Players,
        innings: [],
        currentInning: null
      };

      console.log('Match scoring interface initialized for match:', matchId);
    }

    function createScoringInterface(matchId, matchData, team1Players, team2Players) {
      return `
        <div class="scoring-container">
          <div class="match-header">
            <h3>${matchData.title} Match - ${matchData.venue}</h3>
            <div class="match-info">
              <span>Team 1: ${matchData.team1Id}</span> |
              <span>Team 2: ${matchData.team2Id}</span> |
              <span>Date: ${new Date(matchData.scheduledDate).toLocaleString()}</span>
            </div>
          </div>

          <div class="innings-setup">
            <h4>Set Up First Innings</h4>
            <div class="inning-config">
              <div class="form-group">
                <label>Batting Team:</label>
                <select id="battingTeam">
                  <option value="${matchData.team1Id}">Team 1 (${matchData.team1Id})</option>
                  <option value="${matchData.team2Id}">Team 2 (${matchData.team2Id})</option>
                </select>
              </div>
              <button class="btn" onclick="startInning()">Start Innings</button>
            </div>
          </div>

          <div id="scoring-interface" style="display: none;">
            <!-- Scoring interface will be populated here -->
          </div>
        </div>
      `;
    }

    async function startInning() {
      console.log('startInning called');

      const battingTeamSelect = document.getElementById('battingTeam');
      console.log('battingTeamSelect:', battingTeamSelect);

      if (!battingTeamSelect) {
        alert('Batting team selection not found');
        return;
      }

      const battingTeamId = battingTeamSelect.value;
      console.log('battingTeamId:', battingTeamId);

      if (!battingTeamId) {
        alert('Please select a batting team');
        return;
      }

      const bowlingTeamId = battingTeamId === window.currentMatch.data.team1Id ?
        window.currentMatch.data.team2Id : window.currentMatch.data.team1Id;

      console.log('bowlingTeamId:', bowlingTeamId);

      if (!window.currentMatch || !window.currentMatch.data) {
        alert('Match data not available');
        return;
      }

      console.log('Starting inning with:', { battingTeamId, bowlingTeamId, matchId: window.currentMatch.data.id });

      try {
        const result = await apiCall('/api/scoring/innings', 'POST', {
          matchId: window.currentMatch.data.id,
          battingTeamId: battingTeamId,
          bowlingTeamId: bowlingTeamId
        });

        if (result.success) {
          // Update local match data with the created inning
          const newInning = result.data;
          window.currentMatch.innings.push(newInning);
          window.currentMatch.currentInning = newInning;

          // Update match status
          window.currentMatch.data.status = 'live';
          window.currentMatch.data.currentInnings = newInning.inningNumber;

          // Show scoring interface
          showScoringInterface();

          // Refresh match data in UI
          loadMatches();
        } else {
          alert('Failed to start inning: ' + (result.message || 'Unknown error'));
        }
      } catch (error) {
        console.error('Error starting inning:', error);
        alert('Error starting inning: ' + error.message);
      }
    }

    function showScoringInterface() {
      const inning = window.currentMatch.currentInning;
      const battingPlayers = inning.battingTeamId === window.currentMatch.data.team1Id ?
        window.currentMatch.team1Players : window.currentMatch.team2Players;
      const bowlingPlayers = inning.bowlingTeamId === window.currentMatch.data.team1Id ?
        window.currentMatch.team1Players : window.currentMatch.team2Players;

      const html = `
        <div class="live-scoring">
          <div class="score-display">
            <h4>Innings ${inning.inningNumber}: ${inning.battingTeam} vs ${inning.bowlingTeam}</h4>
            <div class="score-summary">
              <span class="runs">${inning.totalRuns}/${inning.totalWickets}</span>
              <span class="overs">(${Math.floor(inning.totalOvers)}.${inning.totalBalls % 6} overs)</span>
            </div>
          </div>

          <div class="scoring-controls">
            <div class="batsman-selection">
              <h5>Select Batsman</h5>
              <select id="currentBatsman" onchange="selectBatsman()">
                <option value="">Choose batsman...</option>
                ${battingPlayers.map(playerId => {
                  const player = currentData.players.find(p => p.id === playerId);
                  return player ? `<option value="${playerId}">${player.name}</option>` : '';
                }).join('')}
              </select>
            </div>

            <div class="bowler-selection">
              <h5>Select Bowler</h5>
              <select id="currentBowler" onchange="selectBowler()">
                <option value="">Choose bowler...</option>
                ${bowlingPlayers.map(playerId => {
                  const player = currentData.players.find(p => p.id === playerId);
                  return player ? `<option value="${playerId}">${player.name}</option>` : '';
                }).join('')}
              </select>
            </div>

            <div class="runs-input">
              <h5>Add Runs/Wickets</h5>
              <div class="run-buttons">
                <button class="btn" onclick="addRuns(0)">0</button>
                <button class="btn" onclick="addRuns(1)">1</button>
                <button class="btn" onclick="addRuns(2)">2</button>
                <button class="btn" onclick="addRuns(3)">3</button>
                <button class="btn" onclick="addRuns(4)">4</button>
                <button class="btn" onclick="addRuns(6)">6</button>
              </div>
              <div class="wicket-buttons">
                <button class="btn btn-danger" onclick="addWicket('bowled')">Bowled</button>
                <button class="btn btn-danger" onclick="addWicket('caught')">Caught</button>
                <button class="btn btn-danger" onclick="addWicket('runout')">Run Out</button>
                <button class="btn btn-danger" onclick="addWicket('lbw')">LBW</button>
              </div>
            </div>
          </div>

          <div class="current-over">
            <h5>This Over: <span id="current-over-balls"></span></h5>
          </div>

          <div class="inning-actions">
            <button class="btn btn-success" onclick="endInning()">End Innings</button>
            <button class="btn btn-secondary" onclick="saveInningData()">Save Current Data</button>
          </div>
        </div>
      `;

      document.getElementById('scoring-interface').innerHTML = html;
      document.getElementById('scoring-interface').style.display = 'block';
      document.querySelector('.innings-setup').style.display = 'none';
    }

    function selectBatsman() {
      const batsmanId = document.getElementById('currentBatsman').value;
      if (window.currentMatch.currentInning) {
        window.currentMatch.currentInning.currentBatsman = batsmanId;
      }
    }

    function selectBowler() {
      const bowlerId = document.getElementById('currentBowler').value;
      if (window.currentMatch.currentInning) {
        window.currentMatch.currentInning.currentBowler = bowlerId;
      }
    }

    function addRuns(runs) {
      const inning = window.currentMatch.currentInning;
      if (!inning || !inning.currentBatsman || !inning.currentBowler) {
        alert('Please select both batsman and bowler first');
        return;
      }

      // Add to batsman's score
      let batsman = inning.batsmen.find(b => b.playerId === inning.currentBatsman);
      if (!batsman) {
        batsman = {
          playerId: inning.currentBatsman,
          runs: 0,
          balls: 0,
          fours: 0,
          sixes: 0,
          notOut: true
        };
        inning.batsmen.push(batsman);
      }

      batsman.runs += runs;
      batsman.balls += 1;

      if (runs === 4) batsman.fours += 1;
      if (runs === 6) batsman.sixes += 1;

      // Add to bowler's figures
      let bowler = inning.bowling.find(b => b.playerId === inning.currentBowler);
      if (!bowler) {
        bowler = {
          playerId: inning.currentBowler,
          overs: 0,
          balls: 0,
          runs: 0,
          wickets: 0
        };
        inning.bowling.push(bowler);
      }

      bowler.runs += runs;
      bowler.balls += 1;

      // Update over
      inning.currentOver.push(runs);
      inning.totalBalls += 1;

      // Check if over is complete
      if (inning.currentOver.length >= 6) {
        bowler.overs += 1;
        bowler.balls = 0; // Reset balls for next over
        inning.currentOver = [];
        inning.totalOvers += 1;

        // Switch bowler
        document.getElementById('currentBowler').value = '';
        inning.currentBowler = null;
      }

      // Update total runs
      inning.totalRuns += runs;

      // Update display
      updateScoreDisplay();
      updateCurrentOverDisplay();
    }

    function addWicket(type) {
      const inning = window.currentMatch.currentInning;
      if (!inning || !inning.currentBatsman || !inning.currentBowler) {
        alert('Please select both batsman and bowler first');
        return;
      }

      // Mark batsman as out
      const batsman = inning.batsmen.find(b => b.playerId === inning.currentBatsman);
      if (batsman) {
        batsman.notOut = false;
        batsman.dismissalType = type;
      }

      // Add to bowler's wickets
      const bowler = inning.bowling.find(b => b.playerId === inning.currentBowler);
      if (bowler) {
        bowler.wickets += 1;
      }

      // Update totals
      inning.totalWickets += 1;
      inning.totalBalls += 1;

      // Update over
      inning.currentOver.push('W');

      // Check if over is complete
      if (inning.currentOver.length >= 6) {
        if (bowler) {
          bowler.overs += 1;
          bowler.balls = 0;
        }
        inning.currentOver = [];
        inning.totalOvers += 1;
      }

      // Clear current batsman
      document.getElementById('currentBatsman').value = '';
      inning.currentBatsman = null;

      // Update display
      updateScoreDisplay();
      updateCurrentOverDisplay();
    }

    function updateScoreDisplay() {
      const inning = window.currentMatch.currentInning;
      if (!inning) return;

      const scoreElement = document.querySelector('.score-summary .runs');
      const oversElement = document.querySelector('.score-summary .overs');

      if (scoreElement) {
        scoreElement.textContent = `${inning.totalRuns}/${inning.totalWickets}`;
      }

      if (oversElement) {
        const overs = Math.floor(inning.totalOvers) + (inning.totalBalls % 6) / 10;
        oversElement.textContent = `(${overs.toFixed(1)} overs)`;
      }
    }

    function updateCurrentOverDisplay() {
      const inning = window.currentMatch.currentInning;
      if (!inning) return;

      const overElement = document.getElementById('current-over-balls');
      if (overElement) {
        overElement.textContent = inning.currentOver.join(' ');
      }
    }

    async function saveInningData() {
      const match = window.currentMatch;
      const inning = match.currentInning;

      if (!inning) {
        alert('No active inning to save');
        return;
      }

      try {
        // Save inning data to Firestore
        const inningData = {
          inningNumber: inning.inningNumber,
          battingTeam: inning.battingTeam,
          bowlingTeam: inning.bowlingTeam,
          totalRuns: inning.totalRuns,
          totalWickets: inning.totalWickets,
          totalOvers: inning.totalOvers,
          totalBalls: inning.totalBalls
        };

        // Save to matches/{matchId}/innings/{inningId}
        await apiCall(`/api/matches/${match.id}/innings`, 'POST', inningData);

        // Update match scores
        const currentTeam1Score = match.data.team1Score || 0;
        const currentTeam2Score = match.data.team2Score || 0;

        let updatedTeam1Score = currentTeam1Score;
        let updatedTeam2Score = currentTeam2Score;

        // Add innings runs to the batting team's score
        if (inning.battingTeam === match.data.team1Id) {
          updatedTeam1Score += inning.totalRuns;
        } else if (inning.battingTeam === match.data.team2Id) {
          updatedTeam2Score += inning.totalRuns;
        }

        // Update match with new scores
        const matchUpdate = {
          team1Score: updatedTeam1Score,
          team2Score: updatedTeam2Score
        };

        await apiCall(`/api/matches/${match.id}`, 'PUT', matchUpdate);

        // Save batsmen data
        for (const batsman of inning.batsmen) {
          await apiCall(`/api/matches/${match.id}/innings/${inning.inningNumber}/batsmen`, 'POST', batsman);
        }

        // Save bowling data
        for (const bowler of inning.bowling) {
          await apiCall(`/api/matches/${match.id}/innings/${inning.inningNumber}/bowling`, 'POST', bowler);
        }

        alert('Inning data saved successfully!');
        console.log('Inning data saved for match:', match.id);

      } catch (error) {
        console.error('Failed to save inning data:', error);
        alert('Failed to save inning data: ' + error.message);
      }
    }

    function endInning() {
      const inning = window.currentMatch.currentInning;
      if (!inning) return;

      // Mark inning as complete
      inning.completed = true;

      // Save data first
      saveInningData();

      // Check if match should continue with next innings
      const nextInningNumber = window.currentMatch.innings.length + 1;

      if (nextInningNumber <= 2) { // For limited overs, typically 2 innings max
        // Setup next innings
        setTimeout(() => {
          setupNextInning();
        }, 1000);
      } else {
        // Match complete
        alert('Match completed!');
        // Could add match completion logic here
      }
    }

    function setupNextInning() {
      const match = window.currentMatch;
      const html = `
        <div class="innings-setup">
          <h4>Set Up Innings ${match.innings.length + 1}</h4>
          <div class="inning-config">
            <div class="form-group">
              <label>Batting Team:</label>
              <select id="battingTeam">
                <option value="${match.data.team1Id}">Team 1 (${match.data.team1Id})</option>
                <option value="${match.data.team2Id}">Team 2 (${match.data.team2Id})</option>
              </select>
            </div>
            <button class="btn" onclick="startInning()">Start Next Innings</button>
          </div>
        </div>

        <div id="scoring-interface" style="display: none;"></div>
      `;

      document.getElementById('matches-content').innerHTML += html;
    }

    // Burger Menu Functionality
    function toggleMobileMenu() {
      const overlay = document.getElementById('mobileNavOverlay');
      const mobileNav = document.getElementById('mobileNav');
      const burgerMenu = document.querySelector('.burger-menu');

      overlay.classList.toggle('open');
      mobileNav.classList.toggle('open');
      burgerMenu.classList.toggle('open');
    }

    // Close mobile menu when clicking on a link
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('mobile-nav-link')) {
        toggleMobileMenu();
      }
    });

    // Update navigation active states
    function updateNavStates(activeSection) {
      // Update desktop nav
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      document.querySelector(`.nav-link[onclick*="${activeSection}"]`).classList.add('active');

      // Update mobile nav
      document.querySelectorAll('.mobile-nav-link').forEach(link => {
        link.classList.remove('active');
      });
      document.querySelector(`.mobile-nav-link[onclick*="${activeSection}"]`).classList.add('active');
    }

    // Enhanced showSection function
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });

      // Show selected section
      document.getElementById(sectionId).classList.add('active');

      // Update navigation
      updateNavStates(sectionId);

      // Load data if needed
      if (sectionId === 'matches' && !currentData.matches) {
        loadMatches();
      } else if (sectionId === 'teams' && !currentData.teams) {
        loadTeams();
      } else if (sectionId === 'players' && !currentData.players) {
        loadPlayers();
      } else if (sectionId === 'lineups' && !currentData.lineups) {
        loadLineups();
      }
    }

    // Initialize status checks
    checkAPIStatus();
    checkDBStatus();

    // Status checking functions
    async function checkAPIStatus() {
      const statusElement = document.getElementById('api-status');
      const statusDot = document.getElementById('apiStatusDot');

      try {
        const response = await fetch('/api/matches', { method: 'HEAD' });
        if (response.ok) {
          statusElement.textContent = 'Online';
          statusDot.classList.add('online');
          statusDot.classList.remove('offline');
        } else {
          throw new Error('API not responding');
        }
      } catch (error) {
        statusElement.textContent = 'Offline';
        statusDot.classList.add('offline');
        statusDot.classList.remove('online');
      }
    }

    async function checkDBStatus() {
      const statusElement = document.getElementById('db-status');
      const statusDot = document.getElementById('dbStatusDot');

      try {
        const response = await apiCall('/api/matches');
        if (response && response.data) {
          statusElement.textContent = 'Connected';
          statusDot.classList.add('online');
          statusDot.classList.remove('offline');
        } else {
          throw new Error('Database not accessible');
        }
      } catch (error) {
        statusElement.textContent = 'Disconnected';
        statusDot.classList.add('offline');
        statusDot.classList.remove('online');
      }
    }

  </script>

  <!-- App Footer -->
  <footer class="app-footer">
    <div class="footer-content">
      <div class="footer-info">
        <div class="footer-logo">🏏</div>
        <div>
          <p class="footer-text">CricketScores API Explorer</p>
          <p class="footer-text">Built for cricket enthusiasts</p>
        </div>
      </div>

      <div class="footer-links">
        <a href="#" class="footer-link" onclick="showSection('overview')">API Docs</a>
        <a href="#" class="footer-link" onclick="showSection('matches')">Matches</a>
        <a href="#" class="footer-link" onclick="showSection('players')">Players</a>
        <a href="https://github.com" class="footer-link" target="_blank">GitHub</a>
      </div>
    </div>
  </footer>
</body>
</html>
